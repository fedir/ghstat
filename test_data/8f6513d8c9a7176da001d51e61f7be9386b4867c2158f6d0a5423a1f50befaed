HTTP/1.1 200 OK
Transfer-Encoding: chunked
Access-Control-Allow-Origin: *
Access-Control-Expose-Headers: ETag, Link, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval
Cache-Control: no-cache
Content-Security-Policy: default-src 'none'
Content-Type: application/json; charset=utf-8
Date: Mon, 09 Apr 2018 00:31:31 GMT
Link: <https://api.github.com/search/issues?q=repo%3Arails%2Frails+type%3Aissue+state%3Aclosed&page=2>; rel="next", <https://api.github.com/search/issues?q=repo%3Arails%2Frails+type%3Aissue+state%3Aclosed&page=34>; rel="last"
Referrer-Policy: origin-when-cross-origin, strict-origin-when-cross-origin
Server: GitHub.com
Status: 200 OK
Strict-Transport-Security: max-age=31536000; includeSubdomains; preload
X-Accepted-Oauth-Scopes: 
X-Content-Type-Options: nosniff
X-Frame-Options: deny
X-Github-Media-Type: github.v3; format=json
X-Github-Request-Id: D946:54B8:FBCE2B:22E8590:5ACAB463
X-Oauth-Scopes: 
X-Ratelimit-Limit: 30
X-Ratelimit-Remaining: 16
X-Ratelimit-Reset: 1523233950
X-Runtime-Rack: 0.338407
X-Xss-Protection: 1; mode=block

8000
{"total_count":10924,"incomplete_results":false,"items":[{"url":"https://api.github.com/repos/rails/rails/issues/32493","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32493/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32493/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32493/events","html_url":"https://github.com/rails/rails/issues/32493","id":312289888,"number":32493,"title":"Routing wrong action when using \"controller:\"","user":{"login":"hexcat","id":21160542,"avatar_url":"https://avatars2.githubusercontent.com/u/21160542?v=4","gravatar_id":"","url":"https://api.github.com/users/hexcat","html_url":"https://github.com/hexcat","followers_url":"https://api.github.com/users/hexcat/followers","following_url":"https://api.github.com/users/hexcat/following{/other_user}","gists_url":"https://api.github.com/users/hexcat/gists{/gist_id}","starred_url":"https://api.github.com/users/hexcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hexcat/subscriptions","organizations_url":"https://api.github.com/users/hexcat/orgs","repos_url":"https://api.github.com/users/hexcat/repos","events_url":"https://api.github.com/users/hexcat/events{/privacy}","received_events_url":"https://api.github.com/users/hexcat/received_events","type":"User","site_admin":false},"labels":[{"id":150377,"url":"https://api.github.com/repos/rails/rails/labels/docs","name":"docs","color":"02d7e1","default":false}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-04-08T09:32:31Z","updated_at":"2018-04-08T19:22:40Z","closed_at":"2018-04-08T19:17:22Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\n1. Create new application with `rails new`\r\n2. Add `get 'wrong_action', to: :show, controller: 'test'` line to `config/routes.rb`\r\n3. Create `app/controllers/test_controller.rb` and write this code into it:\r\n```\r\nclass TestController < ApplicationController\r\n  def show\r\n    render plain: params\r\n  end\r\nend\r\n```\r\n4. Start server with `bin/rails server -b 127.0.0.1`\r\n5. Navigate web browser to [http://127.0.0.1:3000/wrong_action](http://127.0.0.1:3000/wrong_action)\r\n\r\n### Expected behavior\r\n`{\"controller\"=>\"test\", \"action\"=>\"show\"}` [(Rails Routing from the Outside In)](http://guides.rubyonrails.org/routing.html#singular-resources)\r\n\r\n### Actual behavior\r\n`The action 'wrong_action' could not be found for TestController`\r\n\r\n### System configuration\r\n**Rails version**: 5.1.6\r\n\r\n**Ruby version**: 2.5.1\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32474","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32474/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32474/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32474/events","html_url":"https://github.com/rails/rails/issues/32474","id":311841803,"number":32474,"title":"Uninitialized constant ActionCable","user":{"login":"emikaijuin","id":19805576,"avatar_url":"https://avatars1.githubusercontent.com/u/19805576?v=4","gravatar_id":"","url":"https://api.github.com/users/emikaijuin","html_url":"https://github.com/emikaijuin","followers_url":"https://api.github.com/users/emikaijuin/followers","following_url":"https://api.github.com/users/emikaijuin/following{/other_user}","gists_url":"https://api.github.com/users/emikaijuin/gists{/gist_id}","starred_url":"https://api.github.com/users/emikaijuin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emikaijuin/subscriptions","organizations_url":"https://api.github.com/users/emikaijuin/orgs","repos_url":"https://api.github.com/users/emikaijuin/repos","events_url":"https://api.github.com/users/emikaijuin/events{/privacy}","received_events_url":"https://api.github.com/users/emikaijuin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-04-06T04:04:33Z","updated_at":"2018-04-06T05:01:48Z","closed_at":"2018-04-06T05:01:48Z","author_association":"NONE","body":"I also have a question open on this [at Stack Overflow](https://stackoverflow.com/questions/49670092/uninitialized-constant-actioncable).\r\n\r\nI have a project which was created on Rails 4.2.5 which I upgraded to Rails 5.1.5 to code in a chatroom feature using Action Cable. To upgrade, I changed the version in my rails Gemfile and then used `rake rails:update` to update to the most current version. There were some conflicting files (`config/routes.rb`, `secrets.yml`, `config/development.rb`) during the upgrade, I kept my existing routes.rb and secrets.yml and let the others override per the rails update. \r\n\r\nI then manually created a `app/channels/application_cable` directory and created a `channel.rb` and `connection.rb` file. The current code in these is:\r\n\r\n```\r\nmodule ApplicationCable\r\n  class Channel < ActionCable::Channel::Base\r\n  end\r\nend\r\n```\r\n\r\nand\r\n\r\n\r\n```\r\nmodule ApplicationCable\r\n  class Connection < ActionCable::Connection::Base\r\n    identified_by :current_user\r\n\r\n        def connect\r\n          self.current_user = find_verified_user\r\n          logger.add_tags 'ActionCable', current_user.email\r\n        end\r\n\r\n        protected\r\n\r\n        def find_verified_user # this checks whether a user is authenticated with devise\r\n          if verified_user = env['warden'].user\r\n            verified_user\r\n          else\r\n            reject_unauthorized_connection\r\n          end\r\n        end\r\n  end\r\nend\r\n```\r\n\r\nI have the following ActionCable.server mounted to my `config/routes.rb` as follows:\r\n```\r\ninclude SessionsHelper\r\n\r\nRails.application.routes.draw do\r\n\r\n  [...]\r\n  mount ActionCable.server => '/cable'\r\n  [...]\r\nend\r\n```\r\n\r\nWhenever I try to start my server, it crashes with the following error: \r\n```\r\n/home/ubuntu/workspace/config/routes.rb:39:in `block in <top (required)>': uninitialized constant ActionCable (NameError)\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/actionpack-4.2.5/lib/action_dispatch/routing/route_set.rb:434:in `instance_exec'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/actionpack-4.2.5/lib/action_dispatch/routing/route_set.rb:434:in `eval_block'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/actionpack-4.2.5/lib/action_dispatch/routing/route_set.rb:412:in `draw'\r\n        from /home/ubuntu/workspace/config/routes.rb:3:in `<top (required)>'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:40:in `block in load_paths'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:40:in `each'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:40:in `load_paths'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:16:in `reload!'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:26:in `block in updater'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/activesupport-4.2.5/lib/active_support/file_update_checker.rb:75:in `execute'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:27:in `updater'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/routes_reloader.rb:7:in `execute_if_updated'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application/finisher.rb:69:in `block in <module:Finisher>'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/initializable.rb:30:in `instance_exec'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/initializable.rb:30:in `run'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/initializable.rb:55:in `block in run_initializers'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:228:in `block in tsort_each'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:350:in `block (2 levels) in each_strongly_connected_component'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:431:in `each_strongly_connected_component_from'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:349:in `block in each_strongly_connected_component'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:347:in `each'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:347:in `call'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:347:in `each_strongly_connected_component'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:226:in `tsort_each'\r\n        from /usr/local/rvm/rubies/ruby-2.3.4/lib/ruby/2.3.0/tsort.rb:205:in `tsort_each'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/initializable.rb:54:in `run_initializers'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/application.rb:352:in `initialize!'\r\n        from /home/ubuntu/workspace/config/environment.rb:5:in `<top (required)>'\r\n        from /home/ubuntu/workspace/config.ru:3:in `require'\r\n        from /home/ubuntu/workspace/config.ru:3:in `block in <main>'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/builder.rb:55:in `instance_eval'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/builder.rb:55:in `initialize'\r\n        from /home/ubuntu/workspace/config.ru:in `new'\r\n        from /home/ubuntu/workspace/config.ru:in `<main>'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/builder.rb:49:in `eval'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/builder.rb:49:in `new_from_string'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/builder.rb:40:in `parse_file'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/server.rb:300:in `build_app_and_options_from_config'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/server.rb:209:in `app'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/server.rb:61:in `app'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/rack-1.6.9/lib/rack/server.rb:337:in `wrapped_app'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/server.rb:139:in `log_to_stdout'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/server.rb:78:in `start'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/commands_tasks.rb:80:in `block in server'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/commands_tasks.rb:75:in `tap'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/commands_tasks.rb:75:in `server'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands/commands_tasks.rb:39:in `run_command!'\r\n        from /usr/local/rvm/gems/ruby-2.3.4/gems/railties-4.2.5/lib/rails/commands.rb:17:in `<top (required)>'\r\n        from bin/rails:4:in `require'\r\n        from bin/rails:4:in `<main>'\r\n```\r\n\r\nI have tried adding `require \"action_cable\"` and `require \"action_cable/engine\"` to the `config/application.rb` but it gives back an error `require': cannot load such file -- action_cable/engine (LoadError)` or `require': cannot load such file -- action_cable (LoadError)`\r\n\r\nDoes anybody know how to finalize ActionCable configuration after upgrading to Rails 5? ","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32470","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32470/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32470/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32470/events","html_url":"https://github.com/rails/rails/issues/32470","id":311795473,"number":32470,"title":"ActionView::Helpers::DateHelper#time_ago_in_words is off by an hour","user":{"login":"ilyakatz","id":282514,"avatar_url":"https://avatars1.githubusercontent.com/u/282514?v=4","gravatar_id":"","url":"https://api.github.com/users/ilyakatz","html_url":"https://github.com/ilyakatz","followers_url":"https://api.github.com/users/ilyakatz/followers","following_url":"https://api.github.com/users/ilyakatz/following{/other_user}","gists_url":"https://api.github.com/users/ilyakatz/gists{/gist_id}","starred_url":"https://api.github.com/users/ilyakatz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilyakatz/subscriptions","organizations_url":"https://api.github.com/users/ilyakatz/orgs","repos_url":"https://api.github.com/users/ilyakatz/repos","events_url":"https://api.github.com/users/ilyakatz/events{/privacy}","received_events_url":"https://api.github.com/users/ilyakatz/received_events","type":"User","site_admin":false},"labels":[{"id":107194,"url":"https://api.github.com/repos/rails/rails/labels/activesupport","name":"activesupport","color":"FC9300","default":false}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-04-05T22:50:36Z","updated_at":"2018-04-07T14:50:33Z","closed_at":"2018-04-07T14:50:33Z","author_association":"CONTRIBUTOR","body":"### Steps to reproduce\r\n\r\n```\r\nirb(main):023:0> Time.now\r\n=> 2018-04-05 22:28:50 +0000\r\nirb(main):024:0> Time.now.in_time_zone\r\n=> Thu, 05 Apr 2018 15:28:55 PDT -07:00\r\nirb(main):025:0> time_ago_in_words(Time.now - 15.hours)\r\n=> \"16 hours\"\r\n```\r\n\r\n### Expected behavior\r\nWhen using `distance_of_time_in_words_to_now` helper, it should take into account current Timezone, however, it does not\r\n\r\n### Actual behavior\r\n\r\nTime is off by one hour\r\n\r\n### System configuration\r\n**Rails version**:\r\n\r\n4.2 but looks like it's the same on master\r\n\r\nhttps://github.com/rails/rails/blob/master/actionview/lib/action_view/helpers/date_helper.rb#L177\r\n\r\nThis can be resolved by using `Time.now.in_time_zone` in the argument \r\n\r\n**Ruby version**:\r\n\r\n2.3\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32467","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32467/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32467/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32467/events","html_url":"https://github.com/rails/rails/issues/32467","id":311660253,"number":32467,"title":"Persisting an empty string in an integer field with a default value converts to nil","user":{"login":"gduquesnay","id":84978,"avatar_url":"https://avatars2.githubusercontent.com/u/84978?v=4","gravatar_id":"","url":"https://api.github.com/users/gduquesnay","html_url":"https://github.com/gduquesnay","followers_url":"https://api.github.com/users/gduquesnay/followers","following_url":"https://api.github.com/users/gduquesnay/following{/other_user}","gists_url":"https://api.github.com/users/gduquesnay/gists{/gist_id}","starred_url":"https://api.github.com/users/gduquesnay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gduquesnay/subscriptions","organizations_url":"https://api.github.com/users/gduquesnay/orgs","repos_url":"https://api.github.com/users/gduquesnay/repos","events_url":"https://api.github.com/users/gduquesnay/events{/privacy}","received_events_url":"https://api.github.com/users/gduquesnay/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-04-05T15:32:04Z","updated_at":"2018-04-05T16:31:53Z","closed_at":"2018-04-05T16:31:53Z","author_association":"NONE","body":"### Steps to reproduce\r\nAdd a field such as\r\nt.integer \"time_limit\", default: 0\r\n\r\nupdate(time_limit: '')\r\n\r\nThis is what happens by default if you use are using an input_field to set this integer and the user clears the field and submits the form\r\n\r\n### Expected behavior\r\nSeem like to would be less surprising to set it to the default value\r\n\r\n### Actual behavior\r\nIt get's set to nil\r\n\r\n### System configuration\r\n**Rails version**: 5.1.1\r\n\r\n**Ruby version**: 2.5.0\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32465","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32465/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32465/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32465/events","html_url":"https://github.com/rails/rails/issues/32465","id":311616140,"number":32465,"title":"Using url helper for a route that has constraints does not take encoding into consideration","user":{"login":"zinkkrysty","id":570771,"avatar_url":"https://avatars0.githubusercontent.com/u/570771?v=4","gravatar_id":"","url":"https://api.github.com/users/zinkkrysty","html_url":"https://github.com/zinkkrysty","followers_url":"https://api.github.com/users/zinkkrysty/followers","following_url":"https://api.github.com/users/zinkkrysty/following{/other_user}","gists_url":"https://api.github.com/users/zinkkrysty/gists{/gist_id}","starred_url":"https://api.github.com/users/zinkkrysty/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zinkkrysty/subscriptions","organizations_url":"https://api.github.com/users/zinkkrysty/orgs","repos_url":"https://api.github.com/users/zinkkrysty/repos","events_url":"https://api.github.com/users/zinkkrysty/events{/privacy}","received_events_url":"https://api.github.com/users/zinkkrysty/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-04-05T13:43:47Z","updated_at":"2018-04-05T16:07:48Z","closed_at":"2018-04-05T16:07:48Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\n1. Create a route with a constraint:\r\n```\r\nget 'my_route/:url' => 'my_controller#my_route' url: /[^\\/]+/, as: :my_route\r\n```\r\n\r\n2. Using a helper to create a path:\r\n```\r\nmy_route_path(url: 'http://www.example.com/')\r\n```\r\n\r\n### Expected behavior\r\nHelper outputs: `/my_route/http%3A%2F%2Fwww.example.com%2F` which is a valid route that points to the `my_controller#my_route` action.\r\n\r\nWhen using the helper, the constraint should be applied/verified after the encoding, not before.\r\n\r\n### Actual behavior\r\nAn Error is thrown:\r\n\r\n```\r\nNo route matches {:action=>\"my_route\", :controller=>\"my_controller\"}, missing required keys: [:url]\r\n```\r\n\r\nRequesting this path works though:\r\n\r\n`/my_route/http%3A%2F%2Fwww.example.com%2F`\r\n\r\n### System configuration\r\n**Rails version**:\r\n4.2.8\r\n**Ruby version**:\r\n2.4.0\r\n\r\n\r\n### Bonus: Opposite (but also wrong) behaviour with the same cause\r\n\r\nWhat should happen if the route constraint is excluding valid encoded characters? So having a route like `get 'my_route/:url' => 'my_controller#my_route' url: /[^\\/%]+/, as: :my_route` would output an invalid path (`/my_route/using%3Acolon`) when using the helper `my_route_path(url: 'using:colon')` but won't complain when using the helper.","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32464","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32464/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32464/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32464/events","html_url":"https://github.com/rails/rails/issues/32464","id":311556307,"number":32464,"title":"Assets pipeline URL helpers generate `/javascript/....` instead of `/assets/....`","user":{"login":"snird","id":2139589,"avatar_url":"https://avatars1.githubusercontent.com/u/2139589?v=4","gravatar_id":"","url":"https://api.github.com/users/snird","html_url":"https://github.com/snird","followers_url":"https://api.github.com/users/snird/followers","following_url":"https://api.github.com/users/snird/following{/other_user}","gists_url":"https://api.github.com/users/snird/gists{/gist_id}","starred_url":"https://api.github.com/users/snird/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snird/subscriptions","organizations_url":"https://api.github.com/users/snird/orgs","repos_url":"https://api.github.com/users/snird/repos","events_url":"https://api.github.com/users/snird/events{/privacy}","received_events_url":"https://api.github.com/users/snird/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-05T10:30:46Z","updated_at":"2018-04-05T12:29:06Z","closed_at":"2018-04-05T12:29:05Z","author_association":"NONE","body":"First, I'm sorry I can't attach an example application, as I couldn't reproduce it outside of my production app.\r\nAnd even with it, locally, in development everything worked fine, it was just when deploying to production the weird behaviour occurred.\r\n\r\nI'm in the process of upgrading a rails 4.2 app to rails 5.0. In development, everything works as expected, but the issue occurs only on deployment:\r\nThe assets pipeline compilation works as expected, and all the files are under `/public/assets`, as it always has been.\r\nIn the local development machine, loading every page works as expected, and the URLs for all the assets looks like:\r\n`/assets/application.js`\r\n`/assets/application.css`\r\nBut when deploying the app, the pipeline compilation still compiles as expected, but the URLs in all pages for the assets now looks like:\r\n`/javascripts/application.js`\r\n`/stylesheets/application.css`\r\n\r\nAfter trying long to find solution in google, it seems like it has happen to some people but there was no solution.\r\nI dived into the rails code, which made me wonder how did it ever work.\r\nEvery URL and Tag helper available, from here: https://github.com/rails/rails/tree/5-0-stable/actionview/lib/action_view/helpers\r\nare using the `compute_asset_path` method in the end. https://github.com/rails/rails/blob/4-2-stable/actionview/lib/action_view/helpers/asset_url_helper.rb#L192\r\nAnd this method, determines the path by the `type` of the asset, generating `/javascripts/..` for script etc'.\r\nBut all comments of the function say that is should generate `/assets/...` for everything.\r\n(And I did check, it is the same code for rails 4.2.. it didn't change.)\r\n\r\nSo taking a look at the code did not help.\r\nI feel like I'm missing something obvious. Can someone help me with a pointer?\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32463","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32463/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32463/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32463/events","html_url":"https://github.com/rails/rails/issues/32463","id":311470706,"number":32463,"title":"Implement ApplicationRecord.pluck","user":{"login":"sunnyrjuneja","id":1108341,"avatar_url":"https://avatars3.githubusercontent.com/u/1108341?v=4","gravatar_id":"","url":"https://api.github.com/users/sunnyrjuneja","html_url":"https://github.com/sunnyrjuneja","followers_url":"https://api.github.com/users/sunnyrjuneja/followers","following_url":"https://api.github.com/users/sunnyrjuneja/following{/other_user}","gists_url":"https://api.github.com/users/sunnyrjuneja/gists{/gist_id}","starred_url":"https://api.github.com/users/sunnyrjuneja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sunnyrjuneja/subscriptions","organizations_url":"https://api.github.com/users/sunnyrjuneja/orgs","repos_url":"https://api.github.com/users/sunnyrjuneja/repos","events_url":"https://api.github.com/users/sunnyrjuneja/events{/privacy}","received_events_url":"https://api.github.com/users/sunnyrjuneja/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-04-05T04:42:29Z","updated_at":"2018-04-06T20:20:18Z","closed_at":"2018-04-05T05:12:16Z","author_association":"NONE","body":"Hi,\r\n\r\nI have code that looks like this:\r\n\r\n```ruby\r\nclass Example < ApplicationRecord\r\n  has_many :team\r\n  has_one :individual\r\n\r\n  def notifiers\r\n    if on_team?\r\n      team\r\n    elsif solo?\r\n      individual\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nI want to call `Example.new.notifiers.pluck(:email)` but ApplicationRecord  does not define #pluck. I want ApplicationRecord to define pluck that returns [\"email@gmail.com\"].\r\n\r\nI'm aware that I can do `[individual]` but I think this would be a tiny QOL improvement because I sometimes forget.\r\n\r\nA possible implementation might be\r\n\r\n```ruby\r\ndef pluck(**columns)\r\n  colums.map! { |c| c.to_s }\r\n  [attributes.slice(columns).values]\r\nend\r\n```","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32460","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32460/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32460/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32460/events","html_url":"https://github.com/rails/rails/issues/32460","id":311398142,"number":32460,"title":"Scopes and Single Table Inheritance","user":{"login":"aliCamargo","id":8186569,"avatar_url":"https://avatars0.githubusercontent.com/u/8186569?v=4","gravatar_id":"","url":"https://api.github.com/users/aliCamargo","html_url":"https://github.com/aliCamargo","followers_url":"https://api.github.com/users/aliCamargo/followers","following_url":"https://api.github.com/users/aliCamargo/following{/other_user}","gists_url":"https://api.github.com/users/aliCamargo/gists{/gist_id}","starred_url":"https://api.github.com/users/aliCamargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aliCamargo/subscriptions","organizations_url":"https://api.github.com/users/aliCamargo/orgs","repos_url":"https://api.github.com/users/aliCamargo/repos","events_url":"https://api.github.com/users/aliCamargo/events{/privacy}","received_events_url":"https://api.github.com/users/aliCamargo/received_events","type":"User","site_admin":false},"labels":[{"id":107191,"url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false},{"id":257468118,"url":"https://api.github.com/repos/rails/rails/labels/needs%20work","name":"needs work","color":"000000","default":false}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-04T21:30:14Z","updated_at":"2018-04-04T23:34:59Z","closed_at":"2018-04-04T23:34:59Z","author_association":"NONE","body":"### Steps to reproduce\r\nThe scopes not working correctly in the STI class, when the scope is execute from child class returns all instances of the parent class.\r\n\r\n```Ruby\r\nclass Person < ActiveRecord::Base\r\n  scope :order_by_name, ->(order = 'asc') { order(name: order.to_sym)}\r\nend\r\n\r\nclass LegalPerson < Person\r\n  scope :industrial, -> { where(classification: 'industrial') }\r\n  scope :textile, -> { where(classification: 'textile') }\r\nend\r\n\r\nclass NaturalPerson < Person\r\n  scope :employee, -> { where(classification: 'employee') }\r\n  scope :independent, -> { where(classification: 'independent') }\r\nend\r\n```\r\n\r\n### Expected behavior\r\nThe expected behavior is apply the order scope and keep the conditional `WHERE` because the `scope` is executing on `Legal` model.\r\n\r\n```Ruby\r\nLegal.order_by_name.to_sql\r\n#=> SELECT persons.* FROM persons WHERE persons.type IN ('LegalPerson') ORDER BY persons.name ASC\r\n```\r\n\r\n### Actual behavior\r\nThe Actual behavior is applying the order scope but remove the conditional `WHERE` although the `scope` is executing on `LegalPerson` model.\r\n\r\nApparently, the `scope` is applied in the parent class and return `Person` instances including `NaturalPerson`.\r\n\r\n```Ruby\r\nLegalPerson.order_by_name.to_sql\r\n#=> SELECT persons.* FROM persons ORDER BY persons.name ASC\r\n```\r\n\r\n### System configuration\r\n**Rails version**: Rails 5.1.5\r\n\r\n**Ruby version**: ruby-2.5.0\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32459","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32459/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32459/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32459/events","html_url":"https://github.com/rails/rails/issues/32459","id":311394913,"number":32459,"title":"ActiveJob::TestHelper methods cause SystemStackError: stack level too deep errors","user":{"login":"katiemccann","id":2029820,"avatar_url":"https://avatars3.githubusercontent.com/u/2029820?v=4","gravatar_id":"","url":"https://api.github.com/users/katiemccann","html_url":"https://github.com/katiemccann","followers_url":"https://api.github.com/users/katiemccann/followers","following_url":"https://api.github.com/users/katiemccann/following{/other_user}","gists_url":"https://api.github.com/users/katiemccann/gists{/gist_id}","starred_url":"https://api.github.com/users/katiemccann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/katiemccann/subscriptions","organizations_url":"https://api.github.com/users/katiemccann/orgs","repos_url":"https://api.github.com/users/katiemccann/repos","events_url":"https://api.github.com/users/katiemccann/events{/privacy}","received_events_url":"https://api.github.com/users/katiemccann/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-04-04T21:18:42Z","updated_at":"2018-04-04T22:38:48Z","closed_at":"2018-04-04T21:58:06Z","author_association":"NONE","body":"When I try to use *any* methods from ActiveJob::TestHelper in an integration test, I get a SystemStackError: stack level too deep\r\n\r\n### Steps to reproduce\r\nsimple_test.rb:\r\n```\r\nrequire 'test_helper'\r\ninclude ActiveJob::TestHelper\r\n\r\nclass SimpleTest < ActionDispatch::IntegrationTest\r\n\r\n  test 'simple' do\r\n    perform_enqueued_jobs do\r\n      #do something later\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n`$ rails test test/integration/simple_test.rb`\r\n\r\n> Running via Spring preloader in process 98102\r\n> Run options: --seed 60371\r\n> \r\n> Running:\r\n> \r\n> E\r\n> \r\n> Error:\r\n> SimpleTest#test_simple:\r\n> SystemStackError: stack level too deep\r\n>     test/integration/simple_test.rb:9:in `block in <class:SimpleTest>'\r\n> \r\n> \r\n> bin/rails test test/integration/simple_test.rb:8\r\n> \r\n\r\n### Expected behavior\r\nTest should run  normally\r\n\r\n### Actual behavior\r\nError:\r\nSimpleTest#test_simple:\r\nSystemStackError: stack level too deep\r\n    test/integration/simple_test.rb:9:in `block in <class:SimpleTest>'\r\n\r\n\r\n### System configuration\r\n**Rails version**:\r\n5.1.6 (also happened on 5.1.4)\r\n\r\n**Ruby version**:\r\n 2.5.1 (also happened on 2.3.1)\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32455","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32455/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32455/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32455/events","html_url":"https://github.com/rails/rails/issues/32455","id":311324281,"number":32455,"title":"Ruby 2.2.10 > Ruby 2.2.2","user":{"login":"osburn-sharp","id":325710,"avatar_url
8000
":"https://avatars1.githubusercontent.com/u/325710?v=4","gravatar_id":"","url":"https://api.github.com/users/osburn-sharp","html_url":"https://github.com/osburn-sharp","followers_url":"https://api.github.com/users/osburn-sharp/followers","following_url":"https://api.github.com/users/osburn-sharp/following{/other_user}","gists_url":"https://api.github.com/users/osburn-sharp/gists{/gist_id}","starred_url":"https://api.github.com/users/osburn-sharp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/osburn-sharp/subscriptions","organizations_url":"https://api.github.com/users/osburn-sharp/orgs","repos_url":"https://api.github.com/users/osburn-sharp/repos","events_url":"https://api.github.com/users/osburn-sharp/events{/privacy}","received_events_url":"https://api.github.com/users/osburn-sharp/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-04-04T17:35:33Z","updated_at":"2018-04-08T12:11:44Z","closed_at":"2018-04-04T18:18:24Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\nTry starting Rails 5 with Ruby 2.2.10\r\n\r\n### Expected behavior\r\nShould work OK\r\n\r\n### Actual behavior\r\nThinks that Ruby 2.2.10 < 2.2.2 and refuses to start\r\n\r\n### System configuration\r\n**Rails version**: 5.1.4\r\n\r\n**Ruby version**: 2.2.10\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32452","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32452/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32452/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32452/events","html_url":"https://github.com/rails/rails/issues/32452","id":311273476,"number":32452,"title":"Shopify/bootsnap gem breaks `webpacker:install`","user":{"login":"dwarfmondo","id":156790,"avatar_url":"https://avatars3.githubusercontent.com/u/156790?v=4","gravatar_id":"","url":"https://api.github.com/users/dwarfmondo","html_url":"https://github.com/dwarfmondo","followers_url":"https://api.github.com/users/dwarfmondo/followers","following_url":"https://api.github.com/users/dwarfmondo/following{/other_user}","gists_url":"https://api.github.com/users/dwarfmondo/gists{/gist_id}","starred_url":"https://api.github.com/users/dwarfmondo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dwarfmondo/subscriptions","organizations_url":"https://api.github.com/users/dwarfmondo/orgs","repos_url":"https://api.github.com/users/dwarfmondo/repos","events_url":"https://api.github.com/users/dwarfmondo/events{/privacy}","received_events_url":"https://api.github.com/users/dwarfmondo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-04T15:13:38Z","updated_at":"2018-04-05T14:37:47Z","closed_at":"2018-04-04T22:12:55Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\nExecute a clean install of a new rails `5.2.0.rc2` app with ruby `2.5.0`. With the following command `rails new webpacker-bootsnap-test --webpack=stimulus`. \r\n\r\n### Expected behavior\r\nRails spins up a new app with no errors and a clean configuration of webpack with stimulus js.\r\n\r\n### Actual behavior\r\nInstallation is aborted with an uninitialized constant error and a slew of warnings are logged referring to double loading gems from rbenv and homebrew.\r\n\r\nDouble-Loading Gems with rbenv and homebrew\r\nhttps://github.com/Shopify/bootsnap/issues/112\r\n\r\nUse realpaths in Cache @path_obj\r\nhttps://github.com/Shopify/bootsnap/pull/136\r\n\r\nRemoving the bootsnap gem results in a clean install with expected behavior.\r\n\r\n### System configuration\r\n**Rails version**: 5.2.0.rc2\r\n\r\n**Ruby version**: 2.5.0","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32438","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32438/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32438/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32438/events","html_url":"https://github.com/rails/rails/issues/32438","id":310975375,"number":32438,"title":"Rails-ujs events not firing from links loaded through rails-ujs","user":{"login":"hughkelsey","id":1226188,"avatar_url":"https://avatars3.githubusercontent.com/u/1226188?v=4","gravatar_id":"","url":"https://api.github.com/users/hughkelsey","html_url":"https://github.com/hughkelsey","followers_url":"https://api.github.com/users/hughkelsey/followers","following_url":"https://api.github.com/users/hughkelsey/following{/other_user}","gists_url":"https://api.github.com/users/hughkelsey/gists{/gist_id}","starred_url":"https://api.github.com/users/hughkelsey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hughkelsey/subscriptions","organizations_url":"https://api.github.com/users/hughkelsey/orgs","repos_url":"https://api.github.com/users/hughkelsey/repos","events_url":"https://api.github.com/users/hughkelsey/events{/privacy}","received_events_url":"https://api.github.com/users/hughkelsey/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-04-03T19:55:58Z","updated_at":"2018-04-05T13:07:10Z","closed_at":"2018-04-05T05:16:03Z","author_association":"CONTRIBUTOR","body":"### Steps to reproduce\r\n\r\nI've created a quick example app here: https://shielded-beach-23078.herokuapp.com/examples\r\nThe source is here: https://github.com/hughkelsey/rails-ujs-issue\r\n\r\n1. Visit https://shielded-beach-23078.herokuapp.com/examples\r\n2. Click on any of the links, they will load some basic content with a link through rails-ujs\r\n3. Click on the link that was loaded by rails-ujs\r\n4. This will reload the same partial through rails-ujs\r\n\r\n### Expected behavior\r\nThe ajax:complete event should fire whenever the `data-remote: true` link is clicked.\r\n\r\n### Actual behavior\r\nThe ajax:complete event fires for the links initially loaded but not for the links loaded through rails-ujs.\r\n\r\n### System configuration\r\n**Rails version**: 5.2rc2\r\n**Ruby version**: 2.4.1\r\n\r\nThis issue was originally noticed in 5.1 but the test case above is in 5.2rc2\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32436","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32436/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32436/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32436/events","html_url":"https://github.com/rails/rails/issues/32436","id":310903237,"number":32436,"title":"`.second_to_last` seems to load all records","user":{"login":"aried3r","id":1301152,"avatar_url":"https://avatars1.githubusercontent.com/u/1301152?v=4","gravatar_id":"","url":"https://api.github.com/users/aried3r","html_url":"https://github.com/aried3r","followers_url":"https://api.github.com/users/aried3r/followers","following_url":"https://api.github.com/users/aried3r/following{/other_user}","gists_url":"https://api.github.com/users/aried3r/gists{/gist_id}","starred_url":"https://api.github.com/users/aried3r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aried3r/subscriptions","organizations_url":"https://api.github.com/users/aried3r/orgs","repos_url":"https://api.github.com/users/aried3r/repos","events_url":"https://api.github.com/users/aried3r/events{/privacy}","received_events_url":"https://api.github.com/users/aried3r/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-04-03T16:14:09Z","updated_at":"2018-04-05T02:58:06Z","closed_at":"2018-04-03T17:42:54Z","author_association":"CONTRIBUTOR","body":"### Steps to reproduce\r\n\r\nUsing any record you have, `Record.last` loads just the last record from the database, but `Record.second_to_last` seems to load all of them and then using the array operator `[-1]` (guessing).\r\n\r\n```Ruby\r\n» Message.last\r\n  Message Load (2.2ms)  SELECT  \"messages\".* FROM \"messages\" ORDER BY \"messages\".\"id\" DESC LIMIT $1  [[\"LIMIT\", 1]]\r\n=> #<Message:0x00007fba9e01d190> {\r\n                   :id => 15536,\r\n           :created_at => Tue, 27 Mar 2018 14:31:11 CEST +02:00,\r\n           :updated_at => Tue, 27 Mar 2018 14:31:22 CEST +02:00,\r\n}\r\n» Message.second_to_last\r\n  Message Load (45.4ms)  SELECT \"messages\".* FROM \"messages\" ORDER BY \"messages\".\"id\" ASC\r\n=> #<Message:0x00007fbaa2cc1ca8> {\r\n                   :id => 15535,\r\n           :created_at => Tue, 27 Mar 2018 14:30:11 CEST +02:00,\r\n           :updated_at => Tue, 27 Mar 2018 14:30:16 CEST +02:00,\r\n}\r\n```\r\n\r\nCompare to\r\n```Ruby\r\n» Message.last(2).first\r\n  Message Load (0.5ms)  SELECT  \"messages\".* FROM \"messages\" ORDER BY \"messages\".\"id\" DESC LIMIT $1  [[\"LIMIT\", 2]]\r\n=> #<Message:0x00007fbaa2ce2020> {\r\n                   :id => 15535,\r\n           :created_at => Tue, 27 Mar 2018 14:30:11 CEST +02:00,\r\n           :updated_at => Tue, 27 Mar 2018 14:30:16 CEST +02:00,\r\n}\r\n```\r\n\r\n### Expected behavior\r\n`.second_to_last` should not load all records.\r\n\r\n### Actual behavior\r\n`.second_to_last` seems to load all records.\r\n\r\n### System configuration\r\n**Rails version**: 5.1.6\r\n**Ruby version**: 2.5.1\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32424","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32424/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32424/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32424/events","html_url":"https://github.com/rails/rails/issues/32424","id":310528509,"number":32424,"title":"ActiveSupport::JSON.decode does not decode times","user":{"login":"moubry","id":144283,"avatar_url":"https://avatars3.githubusercontent.com/u/144283?v=4","gravatar_id":"","url":"https://api.github.com/users/moubry","html_url":"https://github.com/moubry","followers_url":"https://api.github.com/users/moubry/followers","following_url":"https://api.github.com/users/moubry/following{/other_user}","gists_url":"https://api.github.com/users/moubry/gists{/gist_id}","starred_url":"https://api.github.com/users/moubry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/moubry/subscriptions","organizations_url":"https://api.github.com/users/moubry/orgs","repos_url":"https://api.github.com/users/moubry/repos","events_url":"https://api.github.com/users/moubry/events{/privacy}","received_events_url":"https://api.github.com/users/moubry/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-04-02T16:14:38Z","updated_at":"2018-04-02T17:30:05Z","closed_at":"2018-04-02T16:22:40Z","author_association":"NONE","body":"I’m confused about whether I should be expecting `ActiveSupport::JSON.decode` to decode times. [The tests for this feature](https://github.com/rails/rails/blob/master/activesupport/test/json/decoding_test.rb) make it seem like this is expected behavior, but I can’t get it to work.\r\n\r\n### Steps to reproduce\r\n\r\n```\r\n#!/usr/bin/env ruby\r\n\r\nrequire 'active_support/all'\r\n\r\ntests = [\r\n  '2007-01-01 01:12:34 Z',\r\n  '2007-01-01 01:12:34',\r\n  '2009-08-10T19:01:02',\r\n  '2009-08-10T19:01:02Z',\r\n  '2009-08-10T19:01:02+02:00',\r\n  '2009-08-10T19:01:02-05:00',\r\n  '1318996912'\r\n]\r\n\r\ntests.each do |test|\r\n  decoded = ActiveSupport::JSON.decode(\"{\\\"now\\\":\\\"#{test}\\\"}\")['now']\r\n  valid = ActiveSupport::JSON::DATETIME_REGEX.match?(test)\r\n  puts \"#{decoded} (valid: #{valid}) => #{decoded.class}\"\r\nend\r\n```\r\n\r\nOutput:\r\n\r\n```\r\n2007-01-01 01:12:34 Z (valid: true) => String\r\n2007-01-01 01:12:34 (valid: true) => String\r\n2009-08-10T19:01:02 (valid: true) => String\r\n2009-08-10T19:01:02Z (valid: true) => String\r\n2009-08-10T19:01:02+02:00 (valid: true) => String\r\n2009-08-10T19:01:02-05:00 (valid: true) => String\r\n1318996912 (valid: false) => String\r\n```\r\n\r\n### Expected behavior\r\n\r\nI expect the decoded ISO 8601 strings to be DateTime objects.\r\n\r\n### Actual behavior\r\n\r\nThey are String objects after decoding.\r\n\r\n### System configuration\r\n**Rails version**: `5.1.6`\r\n\r\n**Ruby version**: `ruby 2.4.3p205 (2017-12-14 revision 61247) [x86_64-darwin17]`\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32413","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32413/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32413/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32413/events","html_url":"https://github.com/rails/rails/issues/32413","id":310423281,"number":32413,"title":"How to disable credentials and use secrets in Rails 5.2 RC2","user":{"login":"nleo","id":800970,"avatar_url":"https://avatars0.githubusercontent.com/u/800970?v=4","gravatar_id":"","url":"https://api.github.com/users/nleo","html_url":"https://github.com/nleo","followers_url":"https://api.github.com/users/nleo/followers","following_url":"https://api.github.com/users/nleo/following{/other_user}","gists_url":"https://api.github.com/users/nleo/gists{/gist_id}","starred_url":"https://api.github.com/users/nleo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nleo/subscriptions","organizations_url":"https://api.github.com/users/nleo/orgs","repos_url":"https://api.github.com/users/nleo/repos","events_url":"https://api.github.com/users/nleo/events{/privacy}","received_events_url":"https://api.github.com/users/nleo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-04-02T08:01:29Z","updated_at":"2018-04-03T03:20:43Z","closed_at":"2018-04-03T03:20:43Z","author_association":"NONE","body":"`application.rb` - `config.require_master_key = false`\r\n\r\n```yaml\r\n# secrets.yml\r\n\r\ndevelopment:\r\n  secret_key_base: 092117...\r\nproduction:\r\n  secret_key_base: 0921asdf4...\r\n```\r\n\r\n\r\n`cap production deploy`\r\n\r\n```\r\n00:39 deploy:assets:precompile\r\n      01 bundle exec rake assets:precompile\r\n      01 ReactOnRails: Set generated_assets_dir to default: public/webpack/production\r\n      01 rake aborted!\r\n      01 ArgumentError: Missing `secret_key_base` for 'production' environment, set this string with `rails credentials:edit`\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:585:in `validate_secret…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:432:in `secret_key_base'\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:176:in `key_generator'\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:205:in `message_verifie…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activestorage-5.2.0.rc2/lib/active_storage/engine.rb:67:in `block (…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:69:in…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:62:in…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:67:in…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:52:in…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:51:in…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:51:in…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application/finisher.rb:75:in `block i…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:32:in `instance_exec'\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:32:in `run'\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:61:in `block in run_i…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:60:in `run_initialize…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:361:in `initialize!'\r\n      01 /home/rails/wallexypro/releases/20180402075603/config/environment.rb:5:in `<main>'\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/loaded_features_index.r…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/dependencies.rb:283:in `…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/dependencies.rb:249:in `…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/dependencies.rb:283:in `…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:337:in `require_environ…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:520:in `block in run_ta…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/sprockets-rails-3.2.1/lib/sprockets/rails/task.rb:62:in `block (2 l…\r\n      01 /home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/rake-12.3.1/exe/rake:27:in `<top (required)>'\r\n      01 Tasks: TOP => environment\r\n      01 (See full trace by running task with --trace)\r\n(Backtrace restricted to imported tasks)\r\ncap aborted!\r\nSSHKit::Runner::ExecuteError: Exception while executing as rails@85.143.172.221: rake exit status: 1\r\nrake stdout: ReactOnRails: Set generated_assets_dir to default: public/webpack/production\r\nrake stderr: rake aborted!\r\nArgumentError: Missing `secret_key_base` for 'production' environment, set this string with `rails credentials:edit`\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:585:in `validate_secret_key_base'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:432:in `secret_key_base'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:176:in `key_generator'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:205:in `message_verifier'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activestorage-5.2.0.rc2/lib/active_storage/engine.rb:67:in `block (2 levels) in <class:Engine>'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:69:in `block in execute_hook'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:62:in `with_execution_control'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:67:in `execute_hook'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:52:in `block in run_load_hooks'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:51:in `each'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/lazy_load_hooks.rb:51:in `run_load_hooks'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application/finisher.rb:75:in `block in <module:Finisher>'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:32:in `instance_exec'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:32:in `run'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:61:in `block in run_initializers'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/initializable.rb:60:in `run_initializers'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:361:in `initialize!'\r\n/home/rails/wallexypro/releases/20180402075603/config/environment.rb:5:in `<main>'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:21:in `require'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:21:in `block in require_with_bootsnap_lfi'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/loaded_features_index.rb:65:in `register'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:20:in `require_with_bootsnap_lfi'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/bootsnap-1.2.1/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:29:in `require'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/dependencies.rb:283:in `block in require'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/dependencies.rb:249:in `load_dependency'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/activesupport-5.2.0.rc2/lib/active_support/dependencies.rb:283:in `require'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:337:in `require_environment!'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/railties-5.2.0.rc2/lib/rails/application.rb:520:in `block in run_tasks_blocks'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/sprockets-rails-3.2.1/lib/sprockets/rails/task.rb:62:in `block (2 levels) in define'\r\n/home/rails/wallexypro/shared/bundle/ruby/2.5.0/gems/rake-12.3.1/exe/rake:27:in `<top (required)>'\r\nTasks: TOP => environment\r\n(See full trace by running task with --trace)\r\n```","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32411","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32411/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32411/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32411/events","html_url":"https://github.com/rails/rails/issues/32411","id":310395025,"number":32411,"title":"'stack level too deep' happens while reading secrets.","user":{"login":"showmant","id":5019215,"avatar_url":"https://avatars1.githubusercontent.com/u/5019215?v=4","gravatar_id":"","url":"https://api.github.com/users/showmant","html_url":"https://github.com/showmant","followers_url":"https://api.github.com/users/showmant/followers","following_url":"https://api.github.com/users/showmant/following{/other_user}","gists_url":"https://api.github.com/users/showmant/gists{/gist_id}","starred_url":"https://api.github.com/users/showmant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/showmant/subscriptions","organizations_url":"https://api.github.com/users/showmant/orgs","repos_url":"https://api.github.com/users/showmant/repos","events_url":"https://api.github.com/users/showmant/events{/privacy}","received_events_url":"https://api.github.com/users/showmant/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-04-02T04:56:34Z","updated_at":"2018-04-02T05:50:29Z","closed_at":"2018-04-02T05:50:29Z","author_association":"NONE","body":"### Steps to reproduce\r\n1. `rails secrets:setup`\r\n2. `bin/rails secrets:edit`(add secret_key_base for staging environment)\r\n3. `rails s`\r\n### Expected behavior\r\nrains server/console should run\r\n### Actual behavior\r\nwhen I try to run rails server or console....\r\n```\r\n##rails server\r\n> user:$ rails s\r\n=> Booting Puma\r\n=> Rails 5.1.4 application starting in development\r\n=> Run `rails server -h` for more startup options\r\nExiting\r\n/Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:717:in `initialize': stack level too deep (SystemStackError)\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:842:in `new'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:842:in `make_compiler'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:831:in `initialize'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:27:in `new'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:27:in `block in parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each_with_object'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `parse'\r\n         ... 10075 levels...\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:68:in `require'\r\n        from /Users/username/Program/Rails/project-name/bin/spring:15:in `<top (required>'\r\n        from bin/rails:3:in `load'\r\n        from bin/rails:3:in `<main>'\r\n\r\n##rails console\r\n> user:$ rails c\r\n\r\n/Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:688:in `===': stack level too deep (SystemStackError)\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:688:in `prepare_trim_mode'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:717:in `initialize'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:842:in `new'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:842:in `make_compiler'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:831:in `initialize'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:27:in `new'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:27:in `block in parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each_with_object'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/application.rb:391:in `secrets'\r\n        from (erb):32:in `<main>'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:896:in `eval'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/erb.rb:896:in `result'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:27:in `block in parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each_with_object'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/application.rb:391:in `secrets'\r\n        from (erb):32:in `<main>'\r\n                from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:27:in `block in parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `each_with_object'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/secrets.rb:24:in `parse'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/application.rb:391:in `secrets'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/application.rb:172:in `key_generator'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/globalid-0.4.1/lib/global_id/railtie.rb:26:in `block (2 levels) in <class:Railtie>'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.4/lib/active_support/lazy_load_hooks.rb:67:in `block in execute_hook'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.4/lib/active_support/lazy_load_hooks.rb:60:in `with_execution_control'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.4/lib/active_support/lazy_load_hooks.rb:65:in `execute_hook'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.4/lib/active_support/lazy_load_hooks.rb:50:in `block in run_load_hooks'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.4/lib/active_support/lazy_load_hooks.rb:49:in `each'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.4/lib/active_support/lazy_load_hooks.rb:49:in `run_load_hooks'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/application/finisher.rb:73:in `block in <module:Finisher>'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/initializable.rb:30:in `instance_exec'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/initializable.rb:30:in `run'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/initializable.rb:59:in `block in run_initializers'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:228:in `block in tsort_each'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:350:in `block (2 levels) in each_strongly_
8000
connected_component'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:431:in `each_strongly_connected_component_from'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:349:in `block in each_strongly_connected_component'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:347:in `each'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:347:in `call'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:347:in `each_strongly_connected_component'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:226:in `tsort_each'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/tsort.rb:205:in `tsort_each'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/initializable.rb:58:in `run_initializers'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/railties-5.1.4/lib/rails/application.rb:353:in `initialize!'\r\n        from /Users/username/Program/Rails/project-name/config/environment.rb:5:in `<top (required)>'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application.rb:102:in `require'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application.rb:102:in `preload'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application.rb:153:in `serve'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application.rb:141:in `block in run'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application.rb:135:in `loop'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application.rb:135:in `run'\r\n        from /Users/username/Program/Rails/project-name/vendor/bundle/ruby/2.4.0/gems/spring-2.0.2/lib/spring/application/boot.rb:19:in `<top (required)>'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n        from /Users/username/.rbenv/versions/2.4.3/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n        from -e:1:in `<main>'\r\n```\r\n\r\nthis problem doesn't happen when I remove `secrets.yml`. it seems `secrets.yml` is called recursively. this happens after using `rails secrets:setup` and `EDITOR=vim rails secrets:edit`.\r\ncould anyone help me??:(\r\n\r\n### System configuration\r\n**Rails version**:\r\n5.1.4\r\n**Ruby version**:\r\n2.4.3","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32402","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32402/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32402/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32402/events","html_url":"https://github.com/rails/rails/issues/32402","id":310298644,"number":32402,"title":"Make confirm dialog overridable in rails_ujs","user":{"login":"mathieumahe","id":2779402,"avatar_url":"https://avatars2.githubusercontent.com/u/2779402?v=4","gravatar_id":"","url":"https://api.github.com/users/mathieumahe","html_url":"https://github.com/mathieumahe","followers_url":"https://api.github.com/users/mathieumahe/followers","following_url":"https://api.github.com/users/mathieumahe/following{/other_user}","gists_url":"https://api.github.com/users/mathieumahe/gists{/gist_id}","starred_url":"https://api.github.com/users/mathieumahe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mathieumahe/subscriptions","organizations_url":"https://api.github.com/users/mathieumahe/orgs","repos_url":"https://api.github.com/users/mathieumahe/repos","events_url":"https://api.github.com/users/mathieumahe/events{/privacy}","received_events_url":"https://api.github.com/users/mathieumahe/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-04-01T05:54:22Z","updated_at":"2018-04-01T10:54:16Z","closed_at":"2018-04-01T06:18:10Z","author_association":"CONTRIBUTOR","body":"I would like to override the default confirm dialog in `rails_ujs` to add different possibilities (a nice modal instead of the default box, add a prompt before destroying super-sensitive data like github does with repos, etc.)\r\n\r\nOne possibility would be to reference the method as `Rails.handleConfirm` instead of using a variable here : https://github.com/rails/rails/blob/896ee2b679462e7bcaa6890c6f5fdbd3b2e2fccb/actionview/app/assets/javascripts/rails-ujs/start.coffee#L45 \r\nLike that, we could override it between the `import` and the call to `Rails.start()`\r\n\r\nEven better, if we could extract the code of the confirm call https://github.com/rails/rails/blob/896ee2b679462e7bcaa6890c6f5fdbd3b2e2fccb/actionview/app/assets/javascripts/rails-ujs/features/confirm.coffee#L23 in a method accessible from outside the scope of the file, we could be able to redefine only the code we need. \r\n\r\nWhat do you think ?\r\n\r\nThanks !","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32393","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32393/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32393/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32393/events","html_url":"https://github.com/rails/rails/issues/32393","id":310239006,"number":32393,"title":"Getting \"undefined method each_pair\" after edge Rails upgrade if repo has no tests","user":{"login":"jasnow","id":43523,"avatar_url":"https://avatars1.githubusercontent.com/u/43523?v=4","gravatar_id":"","url":"https://api.github.com/users/jasnow","html_url":"https://github.com/jasnow","followers_url":"https://api.github.com/users/jasnow/followers","following_url":"https://api.github.com/users/jasnow/following{/other_user}","gists_url":"https://api.github.com/users/jasnow/gists{/gist_id}","starred_url":"https://api.github.com/users/jasnow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasnow/subscriptions","organizations_url":"https://api.github.com/users/jasnow/orgs","repos_url":"https://api.github.com/users/jasnow/repos","events_url":"https://api.github.com/users/jasnow/events{/privacy}","received_events_url":"https://api.github.com/users/jasnow/received_events","type":"User","site_admin":false},"labels":[{"id":107191,"url":"https://api.github.com/repos/rails/rails/labels/activerecord","name":"activerecord","color":"0b02e1","default":false}],"state":"closed","locked":false,"assignee":{"login":"eileencodes","id":1080678,"avatar_url":"https://avatars0.githubusercontent.com/u/1080678?v=4","gravatar_id":"","url":"https://api.github.com/users/eileencodes","html_url":"https://github.com/eileencodes","followers_url":"https://api.github.com/users/eileencodes/followers","following_url":"https://api.github.com/users/eileencodes/following{/other_user}","gists_url":"https://api.github.com/users/eileencodes/gists{/gist_id}","starred_url":"https://api.github.com/users/eileencodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eileencodes/subscriptions","organizations_url":"https://api.github.com/users/eileencodes/orgs","repos_url":"https://api.github.com/users/eileencodes/repos","events_url":"https://api.github.com/users/eileencodes/events{/privacy}","received_events_url":"https://api.github.com/users/eileencodes/received_events","type":"User","site_admin":true},"assignees":[{"login":"eileencodes","id":1080678,"avatar_url":"https://avatars0.githubusercontent.com/u/1080678?v=4","gravatar_id":"","url":"https://api.github.com/users/eileencodes","html_url":"https://github.com/eileencodes","followers_url":"https://api.github.com/users/eileencodes/followers","following_url":"https://api.github.com/users/eileencodes/following{/other_user}","gists_url":"https://api.github.com/users/eileencodes/gists{/gist_id}","starred_url":"https://api.github.com/users/eileencodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eileencodes/subscriptions","organizations_url":"https://api.github.com/users/eileencodes/orgs","repos_url":"https://api.github.com/users/eileencodes/repos","events_url":"https://api.github.com/users/eileencodes/events{/privacy}","received_events_url":"https://api.github.com/users/eileencodes/received_events","type":"User","site_admin":true}],"milestone":{"url":"https://api.github.com/repos/rails/rails/milestones/63","html_url":"https://github.com/rails/rails/milestone/63","labels_url":"https://api.github.com/repos/rails/rails/milestones/63/labels","id":2828826,"number":63,"title":"6.0.0","description":"","creator":{"login":"rafaelfranca","id":47848,"avatar_url":"https://avatars3.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","site_admin":false},"open_issues":0,"closed_issues":8,"state":"open","created_at":"2017-10-10T22:08:21Z","updated_at":"2018-03-31T20:58:55Z","due_on":null,"closed_at":null},"comments":3,"created_at":"2018-03-31T12:59:32Z","updated_at":"2018-03-31T21:23:47Z","closed_at":"2018-03-31T20:58:55Z","author_association":"NONE","body":"### Steps to reproduce\r\n 1. Clone my repo: https://github.com/jasnow/tic-tac-toe\r\n 2. Run \"rake\" and see that it is green.\r\n 3. Verify \"git diff\" to see only difference is new version of edge rails.\r\n 4. Run \"bundle update\" and see that it failed with this error:\r\n```\r\nNoMethodError: undefined method `each_pair' for \"<%= ENV['DATABASE_URL'] %>\":String\r\n$HOME/.rvm/gems/ruby-2.6.0-preview1@ruby2.6-rails5.2/bundler/gems/\r\nrails-5616c08401dd/activerecord/lib/active_record/database_configurations.rb:49:in `walk_configs'\r\n```\r\n5. Last clean Rails upgrade was 5 days ago: 614170e96253981c1974b7232cde024dff19010d\r\n\r\n### Expected behavior\r\nTell us what should happen\r\n```\r\nRun options: --seed 20164\r\n# Running:\r\nFinished in 0.001804s, 0.0000 runs/s, 0.0000 assertions/s.\r\n0 runs, 0 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n### Actual behavior\r\nTell us what happens instead\r\n 4. Run \"bundle update\" and see that it failed with this error:\r\n```\r\nNoMethodError: undefined method `each_pair' for \"<%= ENV['DATABASE_URL'] %>\":String\r\n$HOME/.rvm/gems/ruby-2.6.0-preview1@ruby2.6-rails5.2/bundler/gems/\r\nrails-5616c08401dd/activerecord/lib/active_record/database_configurations.rb:49:in `walk_configs'\r\n```\r\nalong with more stack trace lines.\r\n\r\n### System configuration\r\n**Rails version**:\r\n6.0.0.alpha\r\n\r\n**Ruby version**:\r\nruby 2.6.0preview1","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32385","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32385/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32385/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32385/events","html_url":"https://github.com/rails/rails/issues/32385","id":310175387,"number":32385,"title":"undefined local variable or method `always_initialized' ","user":{"login":"eclemens","id":3135638,"avatar_url":"https://avatars0.githubusercontent.com/u/3135638?v=4","gravatar_id":"","url":"https://api.github.com/users/eclemens","html_url":"https://github.com/eclemens","followers_url":"https://api.github.com/users/eclemens/followers","following_url":"https://api.github.com/users/eclemens/following{/other_user}","gists_url":"https://api.github.com/users/eclemens/gists{/gist_id}","starred_url":"https://api.github.com/users/eclemens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eclemens/subscriptions","organizations_url":"https://api.github.com/users/eclemens/orgs","repos_url":"https://api.github.com/users/eclemens/repos","events_url":"https://api.github.com/users/eclemens/events{/privacy}","received_events_url":"https://api.github.com/users/eclemens/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-30T21:41:44Z","updated_at":"2018-03-31T03:19:36Z","closed_at":"2018-03-31T03:19:36Z","author_association":"NONE","body":"I get an ActiveRecord exception after upgrading from Rails 5.1.5 to 5.1.6. Rolling back to 5.1.5 fixes it.\r\n\r\n### Steps to reproduce\r\n\r\nThe error is triggered if I try to retrieve a record from the database:\r\n```\r\nUser.find(2)\r\n```\r\n\r\n### Expected behavior\r\nI expected to get the User with the ID equals to 2\r\n\r\n### Actual behavior\r\nI got the following exception:\r\n```\r\nundefined local variable or method `always_initialized' for #<ActiveRecord::AttributeSet::Builder:0x00000000070f4c98>\r\n```\r\n\r\n### System configuration\r\n**Rails version**: 5.1.6\r\n\r\n**Ruby version**: ruby-2.4.3\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32379","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32379/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32379/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32379/events","html_url":"https://github.com/rails/rails/issues/32379","id":309935972,"number":32379,"title":"IpSpoofAttackError raised when config.action_dispatch.ip_spoofing_check is false","user":{"login":"wjordan","id":56541,"avatar_url":"https://avatars3.githubusercontent.com/u/56541?v=4","gravatar_id":"","url":"https://api.github.com/users/wjordan","html_url":"https://github.com/wjordan","followers_url":"https://api.github.com/users/wjordan/followers","following_url":"https://api.github.com/users/wjordan/following{/other_user}","gists_url":"https://api.github.com/users/wjordan/gists{/gist_id}","starred_url":"https://api.github.com/users/wjordan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wjordan/subscriptions","organizations_url":"https://api.github.com/users/wjordan/orgs","repos_url":"https://api.github.com/users/wjordan/repos","events_url":"https://api.github.com/users/wjordan/events{/privacy}","received_events_url":"https://api.github.com/users/wjordan/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-29T23:37:38Z","updated_at":"2018-03-30T14:57:01Z","closed_at":"2018-03-30T14:57:01Z","author_association":"CONTRIBUTOR","body":"### Steps to reproduce\r\n\r\n- default Rails app (`rails new`)\r\n- set `config.action_dispatch.ip_spoofing_check = false` in `config/application.rb`\r\n- Run Rails server in development environment (`bin/rails s`)\r\n- send HTTP request with spoofed-ip request headers (`curl`)\r\n\r\nSelf-contained shell script to reproduce issue:\r\n\r\n```\r\n#!/bin/bash\r\nRAILS_PATH=${RAILS_PATH:-/tmp/ip_spoof}\r\nRAILS_VERSION=${RAILS_VERSION:-5.1.6}\r\nRAILS_PORT=${RAILS_PORT:-8001}\r\n\r\nrm -rf ${RAILS_PATH}\r\nrails _${RAILS_VERSION}_ new ${RAILS_PATH} -q > /dev/null\r\npushd ${RAILS_PATH} > /dev/null\r\nsed -i '/Rails::Application/a config.action_dispatch.ip_spoofing_check = false' config/application.rb\r\ncat config/application.rb\r\nbin/rails s -p ${RAILS_PORT} &\r\nsleep 5\r\ncurl localhost:${RAILS_PORT} -H \"X-Forwarded-For: 1.2.3.4\" -H \"Client-Ip: 5.6.7.8\" -I\r\nkill $!\r\npopd > /dev/null\r\n```\r\n\r\n### Actual behavior\r\n\r\nRequest returns status 500 with an `IpSpoofAttackError`:\r\n\r\n```\r\nStarted HEAD \"/\" for 1.2.3.4 at 2018-03-29 16:09:03 -0700\r\n\r\nActionDispatch::RemoteIp::IpSpoofAttackError: IP spoofing attack?! HTTP_CLIENT_IP=\"5.6.7.8\" HTTP_X_FORWARDED_FOR=\"1.2.3.4\"\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/remote_ip.rb:134:in `calculate_ip'\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/remote_ip.rb:153:in `to_s'\r\n\tfrom [GEM]/web-console-3.5.1/lib/web_console/request.rb:21:in `strict_remote_ip'\r\n\tfrom [GEM]/web-console-3.5.1/lib/web_console/request.rb:16:in `from_whitelisted_ip?'\r\n\tfrom [GEM]/web-console-3.5.1/lib/web_console/whiny_request.rb:8:in `from_whitelisted_ip?'\r\n\tfrom [GEM]/web-console-3.5.1/lib/web_console/middleware.rb:20:in `block in call'\r\n\tfrom [GEM]/web-console-3.5.1/lib/web_console/middleware.rb:18:in `catch'\r\n\tfrom [GEM]/web-console-3.5.1/lib/web_console/middleware.rb:18:in `call'\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/show_exceptions.rb:31:in `call'\r\n\tfrom [GEM]/railties-5.1.6/lib/rails/rack/logger.rb:36:in `call_app'\r\n\tfrom [GEM]/railties-5.1.6/lib/rails/rack/logger.rb:24:in `block in call'\r\n\tfrom [GEM]/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `block in tagged'\r\n\tfrom [GEM]/activesupport-5.1.6/lib/active_support/tagged_logging.rb:26:in `tagged'\r\n\tfrom [GEM]/activesupport-5.1.6/lib/active_support/tagged_logging.rb:69:in `tagged'\r\n\tfrom [GEM]/railties-5.1.6/lib/rails/rack/logger.rb:24:in `call'\r\n\tfrom [GEM]/sprockets-rails-3.2.1/lib/sprockets/rails/quiet_assets.rb:13:in `call'\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/remote_ip.rb:79:in `call'\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/request_id.rb:25:in `call'\r\n\tfrom [GEM]/rack-2.0.4/lib/rack/method_override.rb:22:in `call'\r\n\tfrom [GEM]/rack-2.0.4/lib/rack/runtime.rb:22:in `call'\r\n\tfrom [GEM]/activesupport-5.1.6/lib/active_support/cache/strategy/local_cache_middleware.rb:27:in `call'\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/executor.rb:12:in `call'\r\n\tfrom [GEM]/actionpack-5.1.6/lib/action_dispatch/middleware/static.rb:125:in `call'\r\n\tfrom [GEM]/rack-2.0.4/lib/rack/sendfile.rb:111:in `call'\r\n\tfrom [GEM]/railties-5.1.6/lib/rails/engine.rb:522:in `call'\r\n\tfrom [GEM]/puma-3.11.3/lib/puma/configuration.rb:225:in `call'\r\n\tfrom [GEM]/puma-3.11.3/lib/puma/server.rb:624:in `handle_request'\r\n\tfrom [GEM]/puma-3.11.3/lib/puma/server.rb:438:in `process_client'\r\n\tfrom [GEM]/puma-3.11.3/lib/puma/server.rb:302:in `block in run'\r\n\tfrom [GEM]/puma-3.11.3/lib/puma/thread_pool.rb:120:in `block in spawn_thread'\r\nHTTP/1.1 500 Internal Server Error\r\nContent-Type: text/html; charset=UTF-8\r\nX-Request-Id: 0cae9791-f3d5-4b36-8f5d-c7aa31cba837\r\nX-Runtime: 0.000737\r\nContent-Length: 1635\r\n```\r\n\r\n### Expected behavior\r\n\r\nRequest should return status 200, with a 'cannot render console' warning. Here is the output using the fix in rails/web-console#254:\r\n\r\n```\r\nStarted HEAD \"/\" for 1.2.3.4 at 2018-03-29 17:34:22 -0700\r\nCannot render console from [Spoofed]! Allowed networks: 127.0.0.1, ::1, 127.0.0.0/127.255.255.255\r\nProcessing by Rails::WelcomeController#index as */*\r\n  Rendering [GEM]/railties-5.1.6/lib/rails/templates/rails/welcome/index.html.erb\r\n  Rendered [GEM]/railties-5.1.6/lib/rails/templates/rails/welcome/index.html.erb (2.3ms)\r\nCompleted 200 OK in 142ms (Views: 8.8ms)\r\n\r\n\r\nHTTP/1.1 200 OK\r\nX-Frame-Options: SAMEORIGIN\r\nX-XSS-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nContent-Type: text/html; charset=utf-8\r\nETag: W/\"c9fe6ce271930cf13b51692868f07af9\"\r\nCache-Control: max-age=0, private, must-revalidate\r\nX-Request-Id: 2c81cad6-79c4-4529-89ef-35bc15e01127\r\nX-Runtime: 0.150273\r\n```\r\n\r\n### System configuration\r\n**Rails version**:\r\n\r\nLatest (5.1.6)\r\n\r\n**Ruby version**:\r\n\r\n2.5.0\r\n\r\n### Other notes\r\n\r\nThis behavior seems to be caused by `web-console` >= `2.1.3` (rails/web-console@fc321fd8ebc49f4b1f1b0e9201e96a89a276f061), which raises `IpSpoofAttackError` on any requests it processes without regard for the `ip_spoofing_check` setting. `web-console` is included in the default `Gemfile` for Rails since version `4.2`.","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32378","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32378/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32378/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32378/events","html_url":"https://github.com/rails/rails/issues/32378","id":309899318,"number":32378,"title":"ActiveStorage direct_upload failing in IE11 - Assignment to read-only properties is not allowed in strict mode","user":{"login":"kylekeesling","id":103486,"avatar_url":"https://avatars0.githubusercontent.com/u/103486?v=4","gravatar_id":"","url":"https://api.github.com/users/kylekeesling","html_url":"https://github.com/kylekeesling","followers_url":"https://api.github.com/users/kylekeesling/followers","following_url":"https://api.github.com/users/kylekeesling/following{/other_user}","gists_url":"https://api.github.com/users/kylekeesling/gists{/gist_id}","starred_url":"https://api.github.com/users/kylekeesling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kylekeesling/subscriptions","organizations_url":"https://api.github.com/users/kylekeesling/orgs","repos_url":"https://api.github.com/users/kylekeesling/repos","events_url":"https://api.github.com/users/kylekeesling/events{/privacy}","received_events_url":"https://api.github.com/users/kylekeesling/received_events","type":"User","site_admin":false},"labels":[{"id":664533972,"url":"https://api.github.com/repos/rails/rails/labels/activestorage","name":"activestorage","color":"bfd4f2","default":false}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rails/rails/milestones/56","html_url":"https://github.com/rails/rails/milestone/56","labels_url":"https://api.github.com/repos/rails/rails/milestones/56/labels","id":2357255,"number":56,"title":"5.2.0","description":"","creator":{"login":"rafaelfranca","id":47848,"avatar_url":"https://avatars3.githubusercontent.com/u/47848?v=4","gravatar_id":"","url":"https://api.github.com/users/rafaelfranca","html_url":"https://github.com/rafaelfranca","followers_url":"https://api.github.com/users/rafaelfranca/followers","following_url":"https://api.github.com/users/rafaelfranca/following{/other_user}","gists_url":"https://api.github.com/users/rafaelfranca/gists{/gist_id}","starred_url":"https://api.github.com/users/rafaelfranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rafaelfranca/subscriptions","organizations_url":"https://api.github.com/users/rafaelfranca/orgs","repos_url":"https://api.github.com/users/rafaelfranca/repos","events_url":"https://api.github.com/users/rafaelfranca/events{/privacy}","received_events_url":"https://api.github.com/users/rafaelfranca/received_events","type":"User","site_admin":false},"open_issues":2,"closed_issues":73,"state":"open","created_at":"2017-03-01T20:55:32Z","updated_at":"2018-04-07T07:20:17Z","due_on":null,"closed_at":null},"comments":3,"created_at":"2018-03-29T20:50:35Z","updated_at":"2018-04-06T17:00:38Z","closed_at":"2018-04-06T17:00:38Z","author_association":"CONTRIBUTOR","body":"## Steps to reproduce\r\nUsing Active Storage, along with direct upload, upload a file directly to a service (tested with S3) using Internet Explorer 11.\r\n\r\n## Expected behavior\r\nThe file should be properly uploaded via javascript directly to the service.\r\n\r\n## Actual behavior\r\nIE throws an error when the file upload is complete to S3 and the form submits:\r\n```\r\nAssignment to read-only properties is not allowed in strict mode\r\nFile: activestorage.self-*.js, Line: 1, Column: 3274\r\n```\r\nWhich I tracked down to this line of code:\r\n\r\nhttps://github.com/rails/rails/blob/f9ec3e5cc3753b7a46cc1a34d57ca941e4cf7211/activestorage/app/javascript/activestorage/ujs.js#L62\r\n\r\nI'm still wrapping my head around this code but it seems to me as though the form is being modified after it's submitted, and IE doesn't like it. I'm happy to help correct it if someone can point me in the direction.\r\n\r\n**System configuration**\r\nRails version:\r\n5.2.0rc2\r\n\r\n**Ruby version**:\r\nruby 2.5.0","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32377","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32377/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32377/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32377/events","html_url":"https://github.com/rails/rails/issues/32377","id":309884865,"number":32377,"title":"Cannot retrieve STI class subclasses via query after reloading","user":{"login":"fakenine","id":5814696,"avatar_url":"https://avatars2.githubusercontent.com/u/5814696?v=4","gravatar_id":"","url":"https://api.github.com/users/fakenine","html_url":"https://github.com/fakenine","followers_url":"https://api.github.com/users/fakenine/followers","following_url":"https://api.github.com/users/fakenine/following{/other_user}","gists_url":"https://api.github.com/users/fakenine/gists{/gist_id}","starred_url":"https://api.github.com/users/fakenine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakenine/subscriptions","organizations_url":"https://api.github.com/users/fakenine/orgs","repos_url":"https://api.github.com/users/fakenine/repos","events_url":"https://api.github.com/users/fakenine/events{/privacy}","received_events_url":"https://api.github.com/users/fakenine/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-29T20:00:42Z","updated_at":"2018-03-29T20:07:35Z","closed_at":"2018-03-29T20:07:35Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\nHello,\r\n\r\nIn an engine, I have something like this : \r\n\r\n```ruby\r\nmodule MyEngine\r\n  class User < ApplicationRecord\r\n  end\r\nend\r\n```\r\n```ruby\r\nmodule MyEngine\r\n  class Users::Client < User\r\n  end\r\nend\r\n```\r\n\r\n```ruby\r\nmodule MyEngine\r\n  class Users::Admin < User\r\n  end\r\nend\r\n```\r\n\r\n```ruby\r\nmodule MyEngine\r\n  class Users::Admins::Accountant < Users::Admin\r\n  end\r\nend\r\n```\r\n\r\n```ruby\r\nmodule MyEngine\r\n  class Users::Admins::Support < Users::Admin\r\n  end\r\nend\r\n```\r\n\r\nThe issue happens when I try to retrieve all the created `Users::Admin`, after the app is reloaded. For instance, if reproducing this via the console : \r\n\r\n```\r\n2.5.0 :001 > MyEngine::Users::Admin.all\r\n=> #<ActiveRecord::Relation []>\r\n2.5.0 :002 > FactoryBot.create(:my_engine_users_admin_accountant)\r\n=> #<MyEngine::Users::Admins::Accountant id: 6, ....\r\n2.5.0 :003 > MyEngine::Users::Admin.all\r\n=> #<ActiveRecord::Relation [#<MyEngine::Users::Admin::Accountant id: 6, ...\r\n2.5.0 :004 > reload!\r\nReloading...\r\n2.5.0 :005 > MyEngine::Users::Admin.all\r\n=> #<ActiveRecord::Relation []>\r\n```\r\n\r\n### Expected behavior\r\n\r\nThe query should return all the Users who are of kind/have inherited Users::Admin, like after line `:003`\r\n\r\n### Actual behavior\r\n\r\nAn empty collection is returned after reloading.\r\nThe only way to access my records querying via `MyEngine::User`\r\n\r\n### System configuration\r\n**Rails version**: 5.1.5\r\n\r\n**Ruby version**: ruby 2.5.0p0 (2017-12-25 revision 61468) [x86_64-darwin17]\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32376","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32376/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32376/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32376/events","html_url":"https://github.com/rails/rails/issues/32376","id":309819571,"number":32376,"title":"Support validate ... on: :destroy","user":{"login":"ragurney","id":15261525,"avatar_url":"https://avatars0.githubusercontent.com/u/15261525?v=4","gravatar_id":"","url":"https://api.github.com/users/ragurney","html_url":"https://github.com/ragurney","followers_url":"https://api.github.com/users/ragurney/followers","following_url":"https://api.github.com/users/ragurney/following{/other_user}","gists_url":"https://api.github.com/users/ragurney/gists{/gist_id}","starred_url":"https://api.github.com/users/ragurney/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ragurney/subscriptions","organizations_url":"https://api.github.com/users/ragurney/orgs","repos_url":"https://api.github.com/users/ragurney/repos","events_url":"https://api.github.com/users/ragurney/events{/privacy}","received_events_url":"https://api.github.com/users/ragurney/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-03-29T16:22:10Z","updated_at":"2018-03-29T22:00:58Z","closed_at":"2018-03-29T21:43:28Z","author_association":"NONE","body":"### Steps to reproduce\r\nI just tried something like \r\n\r\n```ruby\r\nvalidate :validate_test, on: :destroy\r\n...\r\ndef validate_test\r\n  puts 'hello'\r\n  errors.add(:base, 'fail')\r\n  throw(:abort)\r\nend\r\n```\r\n\r\nwhich silently failed. I ended up digging through stackoverflow and found this patch that would make it work:\r\n```ruby\r\nclass ApplicationRecord < ActiveRecord::Base\r\n  before_destroy do\r\n    throw :abort if invalid?(:destroy)\r\n  end\r\nend\r\n```\r\n\r\n\r\nWould you accept a PR to add something similar so it works out of the box? \r\n\r\n### System configuration\r\n**Rails version**:\r\n5.1.2\r\n\r\n**Ruby version**:\r\n2.5.0","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32371","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32371/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32371/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32371/events","html_url":"https://github.com/rails/rails/issues/32371","id":309688593,"number":32371,"title":"the dependency gem mail 2.7.0 occur warning and bug","user":{"login":"YaEvan","id":17684260,"avatar_url":"https://avatars1.githubusercontent.com/u/17684260?v=4","gravatar_id":"","url":"https://api.github.com/users/YaEvan","html_url":"https://github.com/YaEvan","followers_url":"https://api.github.com/users/YaEvan/followers","following_url":"https://api.github.com/users/YaEvan/following{/other_user}","gists_url":"https://api.github.com/users/YaEvan/gists{/gist_id}","starred_url":"https://api.github.com/users/YaEvan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YaEvan/subscriptions","organizations_url":"https://api.github.com/users/YaEvan/orgs","repos_url":"https://api.github.com/users/YaEvan/repos","events_url":"https://api.github.com/users/YaEvan/events{/privacy}","received_events_url":"https://api.github.com/users/YaEvan/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-29T09:45:24Z","updated_at":"2018-03-30T01:33:23Z","closed_at":"2018-03-29T12:55:43Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\n(Guidelines for creating a bug report are [available\r\nhere](http://guides.rubyonrails.org/contributing_to_ruby_on_rails.html#creating-a-bug-report))\r\n\r\n### Expected behav
4b5d
ior\r\nrun bin/rspec,  the mail v2.7.0 occur error\r\n[mail issues](https://github.com/mikel/mail/pull/1162) \r\n\r\n### Actual behavior\r\n`/Users/evanyang/.rvm/gems/ruby-2.3.1@everydayrails/gems/mail-2.7.0/lib/mail/parsers/content_type_parser.rb:938: warning: statement not reached\r\n/Users/evanyang/.rvm/gems/ruby-2.3.1@everydayrails/gems/mail-2.7.0/lib/mail/parsers/content_type_parser.rb:963: warning: statement not reached\r\n/Users/evanyang/.rvm/gems/ruby-2.3.1@everydayrails/gems/mail-2.7.0/lib/mail/parsers/content_type_parser.rb:1034: warning: mismatched indentations at 'end' with 'while' at 725\r\n/Users/evanyang/.rvm/gems/ruby-2.3.1@everydayrails/gems/mail-2.7.0/lib/mail/parsers/content_type_parser.rb:1035: warning: mismatched indentations at 'end' with 'begin' at 716\r\n/Users/evanyang/.rvm/gems/ruby-2.3.1@everydayrails/gems/mail-2.7.0/lib/mail/parsers/content_type_parser.rb:717: warning: assigned but unused variable - testEof`\r\nOr\r\n`/Users/evanyang/.rvm/gems/ruby-2.3.1@everydayrails/gems/mail-2.7.0/lib/mail/fields/content_type_field.rb:39: [BUG] Segmentation fault at 0x0070000e80b438\r\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-darwin16]...`\r\n\r\nFinanlly, I changed mail version from 2.7.0 to 2.6.6 and fix it.\r\n### System configuration\r\n**Rails version**:\r\n5.1.5 `s.add_dependency \"mail\", [\"~> 2.5\", \">= 2.5.4\"]`\r\n**Ruby version**:\r\n2.3.1","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32368","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32368/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32368/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32368/events","html_url":"https://github.com/rails/rails/issues/32368","id":309615156,"number":32368,"title":"Optimistic Locking: ActiveRecord::StaleObjectError exception only raise once","user":{"login":"phanviet","id":2238528,"avatar_url":"https://avatars2.githubusercontent.com/u/2238528?v=4","gravatar_id":"","url":"https://api.github.com/users/phanviet","html_url":"https://github.com/phanviet","followers_url":"https://api.github.com/users/phanviet/followers","following_url":"https://api.github.com/users/phanviet/following{/other_user}","gists_url":"https://api.github.com/users/phanviet/gists{/gist_id}","starred_url":"https://api.github.com/users/phanviet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phanviet/subscriptions","organizations_url":"https://api.github.com/users/phanviet/orgs","repos_url":"https://api.github.com/users/phanviet/repos","events_url":"https://api.github.com/users/phanviet/events{/privacy}","received_events_url":"https://api.github.com/users/phanviet/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-29T04:22:57Z","updated_at":"2018-03-29T10:27:08Z","closed_at":"2018-03-29T10:27:08Z","author_association":"NONE","body":"### Steps to reproduce\r\n\r\nI use the same command for testing Optimistic Locking as below screenshot:\r\n\r\n![Image](https://www.evernote.com/shard/s510/sh/85515428-6e78-4194-9023-d7860e8f11df/40102f429df18de1/res/ee46994b-79c8-4e7c-beb2-e22636ae539d/skitch.png)\r\n\r\nThe first try is good with the exception was raised. I understand why the command at 2nd try don't raise exception but at 3rd try, I think the exception should be raised again.\r\n\r\n### Expected behavior\r\nRaise ActiveRecord::StaleObjectError exception when using same command at 3rd try, and 5th, ...\r\n\r\n### Actual behavior\r\nOnly raise ActiveRecord::StaleObjectError exception at 1st try.\r\n\r\n### System configuration\r\n**Rails version**:\r\nRails 5.1.5\r\n\r\n**Ruby version**:\r\nRuby 2.5.0","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32367","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32367/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32367/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32367/events","html_url":"https://github.com/rails/rails/issues/32367","id":309514083,"number":32367,"title":"Bug  on rails console when process is suspended","user":{"login":"rderik","id":22192082,"avatar_url":"https://avatars3.githubusercontent.com/u/22192082?v=4","gravatar_id":"","url":"https://api.github.com/users/rderik","html_url":"https://github.com/rderik","followers_url":"https://api.github.com/users/rderik/followers","following_url":"https://api.github.com/users/rderik/following{/other_user}","gists_url":"https://api.github.com/users/rderik/gists{/gist_id}","starred_url":"https://api.github.com/users/rderik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rderik/subscriptions","organizations_url":"https://api.github.com/users/rderik/orgs","repos_url":"https://api.github.com/users/rderik/repos","events_url":"https://api.github.com/users/rderik/events{/privacy}","received_events_url":"https://api.github.com/users/rderik/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-28T20:12:11Z","updated_at":"2018-03-28T20:27:10Z","closed_at":"2018-03-28T20:27:10Z","author_association":"NONE","body":"### Steps to reproduce\r\nRun `rails c` then suspend it by pressing [Ctrl+z]\r\n\r\n### Expected behaviour\r\nThe user shoudl be able to suspend the rails console and then the user should be able to use the shell without any interference.\r\n\r\n### Actual behaviour\r\nThe rails console doesn't seem to be suspended and it is \"fighting\" with the shell for the input and some input goes to the shell and some to the rails console so it breaks all the workflow. \r\n\r\nyou can see a asciinema here: https://asciinema.org/a/pDMvNsyNHek77Ulyx6Z95VTuH\r\n\r\nIf I can be of any help let me know.\r\n\r\n### System configuration\r\n**Rails version**:\r\nRails 5.1.5\r\n**Ruby version**:\r\nruby 2.4.1p111 (2017-03-22 revision 58053) [x86_64-darwin17]\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32358","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32358/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32358/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32358/events","html_url":"https://github.com/rails/rails/issues/32358","id":308984156,"number":32358,"title":"Set S3 bucket path in Active Storage","user":{"login":"olimart","id":547754,"avatar_url":"https://avatars3.githubusercontent.com/u/547754?v=4","gravatar_id":"","url":"https://api.github.com/users/olimart","html_url":"https://github.com/olimart","followers_url":"https://api.github.com/users/olimart/followers","following_url":"https://api.github.com/users/olimart/following{/other_user}","gists_url":"https://api.github.com/users/olimart/gists{/gist_id}","starred_url":"https://api.github.com/users/olimart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olimart/subscriptions","organizations_url":"https://api.github.com/users/olimart/orgs","repos_url":"https://api.github.com/users/olimart/repos","events_url":"https://api.github.com/users/olimart/events{/privacy}","received_events_url":"https://api.github.com/users/olimart/received_events","type":"User","site_admin":false},"labels":[{"id":664533972,"url":"https://api.github.com/repos/rails/rails/labels/activestorage","name":"activestorage","color":"bfd4f2","default":false}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-27T14:05:54Z","updated_at":"2018-03-27T15:35:22Z","closed_at":"2018-03-27T15:35:11Z","author_association":"CONTRIBUTOR","body":"Active Storage - Applicable to S3 config. (maybe others too)\r\n\r\n### Expected behavior\r\nIt would be great to be able to set path within bucket as an option. Applicable to AWS S3, not sure about the other cloud services.\r\n\r\n### Actual behavior\r\nCurrently `storage.yml` has no key for path for AWS S3.\r\n\r\n### System configuration\r\n**Rails version**: 5.2.0.rc2\r\n**Ruby version**: 2.5\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32354","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32354/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32354/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32354/events","html_url":"https://github.com/rails/rails/issues/32354","id":308785159,"number":32354,"title":"Feature Request: Reset column information for AR models after every DDL change.","user":{"login":"fresho-app","id":19561796,"avatar_url":"https://avatars0.githubusercontent.com/u/19561796?v=4","gravatar_id":"","url":"https://api.github.com/users/fresho-app","html_url":"https://github.com/fresho-app","followers_url":"https://api.github.com/users/fresho-app/followers","following_url":"https://api.github.com/users/fresho-app/following{/other_user}","gists_url":"https://api.github.com/users/fresho-app/gists{/gist_id}","starred_url":"https://api.github.com/users/fresho-app/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fresho-app/subscriptions","organizations_url":"https://api.github.com/users/fresho-app/orgs","repos_url":"https://api.github.com/users/fresho-app/repos","events_url":"https://api.github.com/users/fresho-app/events{/privacy}","received_events_url":"https://api.github.com/users/fresho-app/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-27T00:58:08Z","updated_at":"2018-03-27T05:46:43Z","closed_at":"2018-03-27T05:46:43Z","author_association":"NONE","body":"Feature request: Reset column information for AR models after every DDL change.\r\n\r\nRuby 2.4.2\r\nRails 4.2.10\r\n\r\nWhere I work, we have a tendency to create and use migration-specific models for performing data migrations. If we use a migration-specific model, add a column, and then attempt to populate that column all in the same run of `rake db:migrate`, the population of the column will fail, and probably fail silently; we discovered this when our `change_column_null` following the data migration proceeded to fail. Of course, this is without using `reset_column_information`. This will also still happen with two different migration models that point at the same table - there's column information centrally cached somewhere in AR.\r\n\r\nExample of a migration using migration-specific model that will fail:\r\n\r\n```ruby\r\nclass MyMigration < ActiveRecord::Migration\r\n  class MyPostModel < ActiveRecord::Base\r\n    self.table_name = 'my_posts'\r\n  end\r\n\r\n  def up\r\n    MyPostModel.count # access the table somehow\r\n    \r\n    add_column :my_posts, :short_description, :string\r\n\r\n    MyPostModel.find_each do |my_post|\r\n      my_post.new_col = my_post.short_description = my_post.description.truncate(40)\r\n      my_post.save!\r\n    end\r\n\r\n    change_column_null :my_posts, :short_description, false # This will fail\r\n  end\r\nend\r\n```\r\n\r\nWith the addition of `.reset_column_information` this can work:\r\n\r\n```ruby\r\nclass MyMigration < ActiveRecord::Migration\r\n  class MyPostModel < ActiveRecord::Base\r\n    self.table_name = 'my_posts'\r\n  end\r\n\r\n  def up\r\n    MyPostModel.count # access the table somehow\r\n    \r\n    add_column :my_posts, :short_description, :string\r\n    # NEEDED TO CLEAR THE CACHED SCHEMA INFO\r\n    MyPostModel.reset_column_information \r\n\r\n    MyPostModel.find_each do |my_post|\r\n      my_post.new_col = my_post.short_description = my_post.description.truncate(40)\r\n      my_post.save!\r\n    end\r\n\r\n    change_column_null :my_posts, :short_description, false # This will fail\r\n  end\r\nend\r\n```\r\n\r\nHowever, this is easy to forget and this is sometimes not discovered until deploying to an environment where multiple migrations are run together (eg. deploying to production).\r\n\r\nNow, we know that this way of performing data migration or changes to data is not very fast, but is much easier for some developers to understand - not everybody knows SQL very well.\r\n\r\nOur current work-around to stop developers forgetting to use `reset_column_information` is to use a subclass of `ActiveRecord::Migration`, which calls `reset_column_information` after every DDL change, like so:\r\n\r\n```ruby\r\nclass ApplicationMigration < ActiveRecord::Migration\r\n  %i(\r\n      add_column rename_column add_reference\r\n      change_table create_table change_column\r\n      change_column_default change_column_null\r\n  ).each do |method_name|\r\n    define_method method_name do |table_name, *opts|\r\n      super(table_name, *opts)\r\n      reset_column_information_for(table_name)\r\n    end\r\n  end\r\n\r\n  private\r\n\r\n  def reset_column_information_for(table_name)\r\n    ActiveRecord::Base.descendants.each do |model|\r\n      if model.table_name.to_s == table_name.to_s\r\n        model.reset_column_information\r\n      end\r\n    end\r\n  end\r\nend\r\n```","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32353","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32353/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32353/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32353/events","html_url":"https://github.com/rails/rails/issues/32353","id":308735667,"number":32353,"title":"Unregistered encoder in ActionDispatch::IntegrationTest is silently ignored","user":{"login":"jjb","id":6097,"avatar_url":"https://avatars2.githubusercontent.com/u/6097?v=4","gravatar_id":"","url":"https://api.github.com/users/jjb","html_url":"https://github.com/jjb","followers_url":"https://api.github.com/users/jjb/followers","following_url":"https://api.github.com/users/jjb/following{/other_user}","gists_url":"https://api.github.com/users/jjb/gists{/gist_id}","starred_url":"https://api.github.com/users/jjb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjb/subscriptions","organizations_url":"https://api.github.com/users/jjb/orgs","repos_url":"https://api.github.com/users/jjb/repos","events_url":"https://api.github.com/users/jjb/events{/privacy}","received_events_url":"https://api.github.com/users/jjb/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-03-26T21:07:16Z","updated_at":"2018-04-01T17:49:08Z","closed_at":"2018-03-28T04:25:16Z","author_association":"CONTRIBUTOR","body":"### Steps to reproduce\r\n\r\n```ruby\r\nget \"/mypage\", as: :foobar\r\n```\r\n\r\n### Expected behavior\r\n\r\nTest should have an error when trying to use an encoder which does not exist.\r\n\r\n### Actual behavior\r\n\r\nTest silently continues.\r\n\r\n\r\n### System configuration\r\n**Rails version**: 5.1.5\r\n\r\n**Ruby version**: 2.5.0\r\n","score":1.0},{"url":"https://api.github.com/repos/rails/rails/issues/32352","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/32352/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/32352/comments","events_url":"https://api.github.com/repos/rails/rails/issues/32352/events","html_url":"https://github.com/rails/rails/issues/32352","id":308669698,"number":32352,"title":"`.pluck`ing JSONB fields always creates a DB query","user":{"login":"aried3r","id":1301152,"avatar_url":"https://avatars1.githubusercontent.com/u/1301152?v=4","gravatar_id":"","url":"https://api.github.com/users/aried3r","html_url":"https://github.com/aried3r","followers_url":"https://api.github.com/users/aried3r/followers","following_url":"https://api.github.com/users/aried3r/following{/other_user}","gists_url":"https://api.github.com/users/aried3r/gists{/gist_id}","starred_url":"https://api.github.com/users/aried3r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aried3r/subscriptions","organizations_url":"https://api.github.com/users/aried3r/orgs","repos_url":"https://api.github.com/users/aried3r/repos","events_url":"https://api.github.com/users/aried3r/events{/privacy}","received_events_url":"https://api.github.com/users/aried3r/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-03-26T17:42:03Z","updated_at":"2018-03-27T12:29:39Z","closed_at":"2018-03-27T12:18:28Z","author_association":"CONTRIBUTOR","body":"### Steps to reproduce\r\n\r\nHave a model with a JSONB column with nested fields. In my case, it's `image_data` which is used by the [shrine](https://github.com/shrinerb/shrine) gem to store metadata.\r\n\r\nExample:\r\n```JSON\r\n{\r\n  \"thumb\": {\r\n    \"id\": \"randomid\",\r\n    \"storage\": \"store\",\r\n    \"metadata\": {\r\n      \"size\": 23813,\r\n      \"width\": 368,\r\n      \"height\": 276,\r\n      \"filename\": \"thumb_5b72287e-29b9-4d6a-a09e-f5864fca0f93.jpg\",\r\n      \"mime_type\": \"image/jpeg\"\r\n    }\r\n  },\r\n  \"original\": {\r\n    \"id\": \"thumb_randomid\",\r\n    \"storage\": \"store\",\r\n    \"metadata\": {\r\n      \"size\": 2838519,\r\n      \"width\": 3968,\r\n      \"height\": 2976,\r\n      \"filename\": \"5b72287e-29b9-4d6a-a09e-f5864fca0f93.jpg\",\r\n      \"mime_type\": \"image/jpeg\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nNow I want to pluck `size` for example.\r\n```Ruby\r\n# Contrived example, since you wouldn't usually call `.all` to load all images into memory\r\nimages = Image.all\r\n# SELECT \"images\".* FROM \"images\"\r\nimages.pluck(\"image_data -> 'original' -> 'metadata' -> 'size'\")\r\n# SELECT  image_data -> 'original' -> 'metadata' -> 'size' FROM \"images\"\r\nimages.pluck(\"image_data -> 'original' -> 'metadata' -> 'size'\")\r\n# SELECT  image_data -> 'original' -> 'metadata' -> 'size' FROM \"images\"\r\nimages.pluck(\"image_data -> 'original' -> 'metadata' -> 'size'\")\r\n# SELECT  image_data -> 'original' -> 'metadata' -> 'size' FROM \"images\"\r\n```\r\n\r\nIn this case a `.map { |image| image[:original].size }` would be much faster, since it would use the records from memory.\r\n\r\n### Expected behavior\r\nRails should use the loaded records to retrieve the attributes in the JSONB column.\r\n\r\n### Actual behavior\r\n`.pluck` makes a DB query every time. \r\n\r\nMaybe this is similar to https://github.com/rails/rails/pull/25976 and can be fixed similarly, maybe it can't be done or adds too much complexity for this special case but I thought I'd report it anyway.\r\n \r\n### System configuration\r\n**Rails version**:\r\n5.1.5\r\n**Ruby version**:\r\n2.5.0","score":1.0}]}
0

