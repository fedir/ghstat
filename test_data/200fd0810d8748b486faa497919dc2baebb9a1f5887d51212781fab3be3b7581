HTTP/1.1 200 OK
Transfer-Encoding: chunked
Access-Control-Allow-Origin: *
Access-Control-Expose-Headers: ETag, Link, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval
Cache-Control: no-cache
Content-Security-Policy: default-src 'none'
Content-Type: application/json; charset=utf-8
Date: Sun, 15 Apr 2018 13:34:43 GMT
Referrer-Policy: origin-when-cross-origin, strict-origin-when-cross-origin
Server: GitHub.com
Status: 200 OK
Strict-Transport-Security: max-age=31536000; includeSubdomains; preload
X-Accepted-Oauth-Scopes: 
X-Content-Type-Options: nosniff
X-Frame-Options: deny
X-Github-Media-Type: github.v3; format=json
X-Github-Request-Id: D8E3:148B:203E8B3:4695FD0:5AD354F3
X-Oauth-Scopes: 
X-Ratelimit-Limit: 30
X-Ratelimit-Remaining: 29
X-Ratelimit-Reset: 1523799343
X-Runtime-Rack: 0.129721
X-Xss-Protection: 1; mode=block

4e22
{"total_count":6,"incomplete_results":false,"items":[{"url":"https://api.github.com/repos/joaotavora/snooze/issues/9","repository_url":"https://api.github.com/repos/joaotavora/snooze","labels_url":"https://api.github.com/repos/joaotavora/snooze/issues/9/labels{/name}","comments_url":"https://api.github.com/repos/joaotavora/snooze/issues/9/comments","events_url":"https://api.github.com/repos/joaotavora/snooze/issues/9/events","html_url":"https://github.com/joaotavora/snooze/issues/9","id":287525532,"number":9,"title":"A route with an empty argument throws an error \"Can't read from an empty string\"","user":{"login":"vindarel","id":3721004,"avatar_url":"https://avatars3.githubusercontent.com/u/3721004?v=4","gravatar_id":"","url":"https://api.github.com/users/vindarel","html_url":"https://github.com/vindarel","followers_url":"https://api.github.com/users/vindarel/followers","following_url":"https://api.github.com/users/vindarel/following{/other_user}","gists_url":"https://api.github.com/users/vindarel/gists{/gist_id}","starred_url":"https://api.github.com/users/vindarel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vindarel/subscriptions","organizations_url":"https://api.github.com/users/vindarel/orgs","repos_url":"https://api.github.com/users/vindarel/repos","events_url":"https://api.github.com/users/vindarel/events{/privacy}","received_events_url":"https://api.github.com/users/vindarel/received_events","type":"User","site_admin":false},"labels":[{"id":125790582,"url":"https://api.github.com/repos/joaotavora/snooze/labels/question","name":"question","color":"cc317c","default":true}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-01-10T18:00:58Z","updated_at":"2018-01-18T22:27:14Z","closed_at":"2018-01-18T22:27:14Z","author_association":"NONE","body":"I had this route, checking if its parameter is void:\r\n\r\n```\r\n(defroute torrents (:get :text/html &key query)\r\n          ;; now fails if no query. How do we do ?\r\n          (if query\r\n              (print-results (torrents:async-torrents query) query)\r\n              (redirect-to \"index\")))\r\n```\r\n\r\nit worked (mmh… can't be 100% sure now), but now I get an exception from this fix when I explicitly go to an url like  `torrents&query=`, with a trailing `=`. The routes `torrents&query` (no =) or `torrents` do not throw a condition and do redirect to my index.\r\n\r\n```\r\n#<ERROR-WHEN-EXPLAINING #<UNCONVERTIBLE-ARGUMENT 400: Malformed arg for resource TORRENTS>> Here's a little bit more information: \r\nYou got a #<ERROR-WHEN-EXPLAINING \r\n#<UNCONVERTIBLE-ARGUMENT 400: Malformed arg for resource TORRENTS>> because: \r\nSNOOZE:EXPLAIN-CONDITION was trying to explain to the user the condition #<UNCONVERTIBLE-ARGUMENT 400: Malformed arg for resource TORRENTS>. You got a #<UNCONVERTIBLE-ARGUMENT 400: Malformed arg for resource TORRENTS> because: \r\nSNOOZE:URI-TO-ARGUMENTS was trying to make sense of \r\nthe key-value-pair \"query\" and \"\" when it caught #<SNOOZE-READER-ERROR Can't read from an empty string> \r\n\r\nNo more interesting information on #<SNOOZE-READER-ERROR \r\nCan't read from an empty string>, sorry\r\n```\r\n\r\nI highlight:\r\n\r\n    SNOOZE:URI-TO-ARGUMENTS was trying to make sense of the key-value-pair \"query\" and \"\" when it caught #<SNOOZE-READER-ERROR Can't read from an empty string>\r\n\r\nMaybe can Snooze better handle empty strings ?\r\n\r\n","score":1.0},{"url":"https://api.github.com/repos/joaotavora/snooze/issues/8","repository_url":"https://api.github.com/repos/joaotavora/snooze","labels_url":"https://api.github.com/repos/joaotavora/snooze/issues/8/labels{/name}","comments_url":"https://api.github.com/repos/joaotavora/snooze/issues/8/comments","events_url":"https://api.github.com/repos/joaotavora/snooze/issues/8/events","html_url":"https://github.com/joaotavora/snooze/issues/8","id":286619236,"number":8,"title":"Heap exhausted","user":{"login":"vindarel","id":3721004,"avatar_url":"https://avatars3.githubusercontent.com/u/3721004?v=4","gravatar_id":"","url":"https://api.github.com/users/vindarel","html_url":"https://github.com/vindarel","followers_url":"https://api.github.com/users/vindarel/followers","following_url":"https://api.github.com/users/vindarel/following{/other_user}","gists_url":"https://api.github.com/users/vindarel/gists{/gist_id}","starred_url":"https://api.github.com/users/vindarel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vindarel/subscriptions","organizations_url":"https://api.github.com/users/vindarel/orgs","repos_url":"https://api.github.com/users/vindarel/repos","events_url":"https://api.github.com/users/vindarel/events{/privacy}","received_events_url":"https://api.github.com/users/vindarel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-01-08T01:26:06Z","updated_at":"2018-01-10T13:33:20Z","closed_at":"2018-01-09T13:50:27Z","author_association":"NONE","body":"Hello,\r\n\r\nI have some simple code that can throw right away a `heap exhausted` error O_o\r\n\r\n```\r\n$ ./my-app\r\nHunchentoot server is started.\r\nListening on localhost:9005.\r\nHeap exhausted during garbage collection: 32 bytes available, 80 requested.\r\n Gen StaPg UbSta LaSta LUbSt Boxed Unboxed LB   LUB  !move  Alloc  Waste   Trig    WP  GCs Mem-age\r\n   0:     0     0     0     0     0     0     0     0     0        0     0 10737418    0   0  0,0000\r\n   1:     0     0     0     0     0     0     0     0     0        0     0 10737418    0   0  0,0000\r\n   2: 27373 27366     0     0 14426  1312     0     0     0 515026272 676512  2000000    0   0  1,1068\r\n   3:     0     0     0     0     0     0     0     0     0        0     0  2000000    0   0  0,0000\r\n   4:     0     0     0     0     0     0     0     0     0        0     0  2000000    0   0  0,0000\r\n   5:     0     0     0     0     0     0     0     0     0        0     0  2000000    0   0  0,0000\r\n   6:     0     0     0     0  3991  1009     0     0     0 163840000     0  2000000 3820   0  0,0000\r\n   Total bytes allocated    = 1072429888\r\n   Dynamic-space-size bytes = 1073741824\r\nGC control variables:\r\n   *GC-INHIBIT* = true\r\n   *GC-PENDING* = true\r\n   *STOP-FOR-GC-PENDING* = false\r\nfatal error encountered in SBCL pid 5286(tid 140737295906560):\r\nHeap exhausted, game over.\r\n\r\nWelcome to LDB, a low-level debugger for the Lisp runtime environment.\r\nldb> \r\n```\r\n\r\nI built an executable out of the following minimal web app.\r\n\r\nIt defines two routes, an index with a text input and a results page. I noticed the problem when I used the browser's back and forth button, but also right away, now it happened after I entered a search query in the input and validated. I already managed to see search results (or lack of, given the lack of template in this snippet).\r\n\r\n```\r\n(defpackage torrents-gui\r\n  (:use :cl\r\n        :spinneret\r\n        :snooze)\r\n  (:export\r\n   :start-app\r\n   :main))\r\n(in-package :torrents-gui)\r\n\r\n(defvar *server*)\r\n\r\n(defvar *torrents* nil)\r\n(setf *torrents*\r\n  '(((:TITLE . \"Title\")\r\n    …\r\n)))\r\n;;\r\n;; routes\r\n;;\r\n(defroute torrents (:get :text/html &key query)\r\n          (if query\r\n              (print-results *torrents* query) ;; saw \"heap exhausted\" \r\n              ))\r\n\r\n(defroute index (:get :text/*)\r\n          (search-page)) ;; always ok so far\r\n\r\n;; root url\r\n(setf *home-resource* \"index\")\r\n\r\n;; print errors in the browser.\r\n(setf snooze:*catch-errors* :verbose)\r\n(setf hunchentoot:*catch-errors-p* t)\r\n\r\n;;\r\n;; templates\r\n;;\r\n(defmacro with-page ((&key title) &body body)\r\n   `(with-html-string\r\n      (:doctype)\r\n      (:html\r\n       (:head\r\n        (:meta :http-equiv \"Content-Type\" :content \"text/html; charset=utf-8\") ;; useless\r\n        (:meta :charset \"UTF-8\")\r\n        (:meta :charset \"UTF-8\")\r\n        (:link :rel \"stylesheet\" :type \"text/css\" :href \"https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.8/semantic.min.css\")\r\n        (:title ,title))\r\n       (:div :class \"ui grid\"\r\n             (:div :class \"four wide column\")\r\n             (:div :class \"height wide column\"\r\n                   (:body ,@body))))))\r\n\r\n(defun search-page ()\r\n  (with-page (:title \"cl-torrents\")\r\n    (:header\r\n     (:h1 \"index\"))\r\n    (:section\r\n     (:div \"Search\")\r\n     (:form :action \"/torrents\"\r\n      (:div :class \"ui input\"\r\n            (:input :placeholder \"search...\" :name \"search\" :type \"text\"))\r\n      (:button :class \"ui primary button\" :type \"submit\" \"search\")))))\r\n\r\n(defun print-results (res query)\r\n  (if (and res query)\r\n      (with-page (:title \"Torrents debug\"))\r\n   ;; deleted\r\n      ))\r\n\r\n;;\r\n;; app\r\n;;\r\n(defun start-app (&key (port *port*))\r\n  (setf lparallel:*kernel* (lparallel:make-kernel 2))\r\n  (handler-case\r\n      (setq *server* (clack:clackup\r\n                      (snooze:make-clack-app)\r\n                      :port (find-port:find-port :min 9003)))\r\n    ;; not helping ? Hunchentoot takes over.\r\n    (error (c) (format t \"Unexpected error: ~a~&Aborting.~&\" c))))\r\n\r\n(defun main ()\r\n  (start-app)\r\n  (handler-case (bt:join-thread (find-if (lambda (th)\r\n                                           (search \"hunchentoot\" (bt:thread-name th)))\r\n                                         (bt:all-threads)))\r\n    (#+sbcl sb-sys:interactive-interrupt\r\n      #+ccl  ccl:interrupt-signal-condition\r\n      #+clisp system::simple-interrupt-condition\r\n      #+ecl ext:interactive-interrupt\r\n      #+allegro excl:interrupt-signal\r\n      () (progn\r\n           (format *error-output* \"Aborting.~&\")\r\n           (clack:stop *server*)\r\n           (uiop:quit)))\r\n    (error (c) (format t \"Woops, an unknown error occured:~&~a~&\" c))))\r\n\r\n```\r\n\r\nI'm using SBCL 1.2.4.debian, I guess a first step would be to upgrade.\r\n\r\nI've also seen lengthy discussion on pgloader's issue tracker, where he asks to try with CCL, known to have a better GC.\r\n\r\nDo you have an idea of what could be the problem ? It seems to work with no input text, no search result and no macro… but that *can't* be this code, can it ?\r\n\r\n  ","score":1.0},{"url":"https://api.github.com/repos/joaotavora/snooze/issues/7","repository_url":"https://api.github.com/repos/joaotavora/snooze","labels_url":"https://api.github.com/repos/joaotavora/snooze/issues/7/labels{/name}","comments_url":"https://api.github.com/repos/joaotavora/snooze/issues/7/comments","events_url":"https://api.github.com/repos/joaotavora/snooze/issues/7/events","html_url":"https://github.com/joaotavora/snooze/issues/7","id":285225825,"number":7,"title":"Snooze Roadmap","user":{"login":"azzamsa","id":17734314,"avatar_url":"https://avatars2.githubusercontent.com/u/17734314?v=4","gravatar_id":"","url":"https://api.github.com/users/azzamsa","html_url":"https://github.com/azzamsa","followers_url":"https://api.github.com/users/azzamsa/followers","following_url":"https://api.github.com/users/azzamsa/following{/other_user}","gists_url":"https://api.github.com/users/azzamsa/gists{/gist_id}","starred_url":"https://api.github.com/users/azzamsa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azzamsa/subscriptions","organizations_url":"https://api.github.com/users/azzamsa/orgs","repos_url":"https://api.github.com/users/azzamsa/repos","events_url":"https://api.github.com/users/azzamsa/events{/privacy}","received_events_url":"https://api.github.com/users/azzamsa/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-12-30T21:51:44Z","updated_at":"2017-12-31T21:27:54Z","closed_at":"2017-12-30T22:42:46Z","author_association":"NONE","body":"Hi, Távora.\r\nThanks lot for your contribution to community.\r\n\r\nSorry for asking, Is Snooze has roadmap or something like todo list. ?\r\n\r\nThank you.\r\n\r\n*I hope the beta status will dissapear soon :)*","score":1.0},{"url":"https://api.github.com/repos/joaotavora/snooze/issues/6","repository_url":"https://api.github.com/repos/joaotavora/snooze","labels_url":"https://api.github.com/repos/joaotavora/snooze/issues/6/labels{/name}","comments_url":"https://api.github.com/repos/joaotavora/snooze/issues/6/comments","events_url":"https://api.github.com/repos/joaotavora/snooze/issues/6/events","html_url":"https://github.com/joaotavora/snooze/issues/6","id":281197099,"number":6,"title":"How to redirect","user":{"login":"joaotavora","id":387011,"avatar_url":"https://avatars0.githubusercontent.com/u/387011?v=4","gravatar_id":"","url":"https://api.github.com/users/joaotavora","html_url":"https://github.com/joaotavora","followers_url":"https://api.github.com/users/joaotavora/followers","following_url":"https://api.github.com/users/joaotavora/following{/other_user}","gists_url":"https://api.github.com/users/joaotavora/gists{/gist_id}","starred_url":"https://api.github.com/users/joaotavora/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joaotavora/subscriptions","organizations_url":"https://api.github.com/users/joaotavora/orgs","repos_url":"https://api.github.com/users/joaotavora/repos","events_url":"https://api.github.com/users/joaotavora/events{/privacy}","received_events_url":"https://api.github.com/users/joaotavora/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-12-11T22:58:34Z","updated_at":"2017-12-14T13:55:51Z","closed_at":"2017-12-14T09:07:25Z","author_association":"OWNER","body":"@vindarel asks in #5:\r\n\r\n> Another easy question: how would one do a redirection ? Maybe with a funcall or something. Didn't find, skimmed at the readme and api. If that's Clack's job I didn't find it in its doc either (very scarce). A redirect example would be useful.\r\n\r\nIt's a question of signalling a 303 with an appropriate `Location:` header value. I setup a helper function called `redirect-to` or something like that. This one is for hunchentoot but i suppose it's easy to write one for clack or anything else you use...\r\n\r\n```lisp\r\n(defun redirect-to (url &optional\r\n                          (format-control \"Redirected\")\r\n                          format-args)\r\n  (setf (hunchentoot:header-out :location) url)\r\n  (snooze:http-condition 303\r\n                         (format nil \"~?\" format-control format-args)))\r\n```\r\n\r\nand then in some route, say `authenticate`\r\n\r\n```lisp\r\n(snooze:defroute authenticate (:post \"*/*\")\r\n  (cond ((know-this-guy)\r\n         (setup-some-session-info)\r\n         (redirect-to \"/\"))\r\n        (t\r\n         (snooze:http-condition 403 \"Unauthorized\"))))\r\n```\r\n","score":1.0},{"url":"https://api.github.com/repos/joaotavora/snooze/issues/5","repository_url":"https://api.github.com/repos/joaotavora/snooze","labels_url":"https://api.github.com/repos/joaotavora/snooze/issues/5/labels{/name}","comments_url":"https://api.github.com/repos/joaotavora/snooze/issues/5/comments","events_url":"https://api.github.com/repos/joaotavora/snooze/issues/5/events","html_url":"https://github.com/joaotavora/snooze/issues/5","id":279899125,"number":5,"title":"Defining the root route, debugging an internal server error","user":{"login":"vindarel","id":3721004,"avatar_url":"https://avatars3.githubusercontent.com/u/3721004?v=4","gravatar_id":"","url":"https://api.github.com/users/vindarel","html_url":"https://github.com/vindarel","followers_url":"https://api.github.com/users/vindarel/followers","following_url":"https://api.github.com/users/vindarel/following{/other_user}","gists_url":"https://api.github.com/users/vindarel/gists{/gist_id}","starred_url":"https://api.github.com/users/vindarel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vindarel/subscriptions","organizations_url":"https://api.github.com/users/vindarel/orgs","repos_url":"https://api.github.com/users/vindarel/repos","events_url":"https://api.github.com/users/vindarel/events{/privacy}","received_events_url":"https://api.github.com/users/vindarel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-12-06T20:41:10Z","updated_at":"2017-12-11T23:00:45Z","closed_at":"2017-12-11T23:00:45Z","author_association":"NONE","body":"Hello, \r\nAfter trying a bit Ningle and Caveman, Snooze looks sanier (straightforward mapping to query parameters, that sold me). I have two questions.\r\n\r\nI didn't find how to define the root route. `defroute` takes a method name.\r\n\r\n```\r\n(defroute index (:get :text/*)\r\n          (search-page))\r\n```\r\n\r\nand then defines the endpoints `/index/`. What if we just want `/` ? (only `/` is not possible, I tried :) SBCL freaks out)\r\n\r\n---\r\n\r\nI was going to give full details but first: how do you debug a 500 internal server error ? I tested each piece of my route in the repl, with fake data and all, but together it won't pass and I only get this straight error message. And it doesn't help to print \"oh dear, it seems I've messed up\" :)\r\nAlso the browser returns a warning about bad encodings of this plain text error message. A bit disturbing. It is Hunchentoot's fault ?\r\n\r\nThanks !\r\n","score":1.0},{"url":"https://api.github.com/repos/joaotavora/snooze/issues/4","repository_url":"https://api.github.com/repos/joaotavora/snooze","labels_url":"https://api.github.com/repos/joaotavora/snooze/issues/4/labels{/name}","comments_url":"https://api.github.com/repos/joaotavora/snooze/issues/4/comments","events_url":"https://api.github.com/repos/joaotavora/snooze/issues/4/events","html_url":"https://github.com/joaotavora/snooze/issues/4","id":177705181,"number":4,"title":"Following readme, /lispdoc/funny-syntax?package=snooze generates 400 error, not 404","user":{"login":"sabracrolleton","id":5070125,"avatar_url":"https://avatars3.githubusercontent.com/u/5070125?v=4","gravatar_id":"","url":"https://api.github.com/users/sabracrolleton","html_url":"https://github.com/sabracrolleton","followers_url":"https://api.github.com/users/sabracrolleton/followers","following_url":"https://api.github.com/users/sabracrolleton/following{/other_user}","gists_url":"https://api.github.com/users/sabracrolleton/gists{/gist_id}","starred_url":"https://api.github.com/users/sabracrolleton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabracrolleton/subscriptions","organizations_url":"https://api.github.com/users/sabracrolleton/orgs","repos_url":"https://api.github.com/users/sabracrolleton/repos","events_url":"https://api.github.com/users/sabracrolleton/events{/privacy}","received_events_url":"https://api.github.com/users/sabracrolleton/received_events","type":"User","site_admin":false},"labels":[{"id":125790577,"url":"https://api.github.com/repos/joaotavora/snooze/labels/bug","name":"bug","color":"fc2929","default":true}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-09-19T05:13:55Z","updated_at":"2016-09-20T01:49:28Z","closed_at":"2016-09-19T16:36:36Z","author_association":"NONE","body":"If I am following the readme correctly, then \n\nhttp://localhost:9003/lispdoc/defun \n\ngenerates \"Define a function at top level.\" which looks correct, but \n\nhttp://localhost:9003/lispdoc/funny-syntax?package=snooze\n\ngenerates a 400 error\n\nas does \n\nhttp://localhost:9003/lispdoc/start?package=snooze\n\nDid something change or am I missing something?\n","score":1.0}]}
0

